/*!
 * Tiny Comments plugin
 *
 * Copyright (c) 2023 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 7.8.0-1
 */

!function(){"use strict";var e=function(e){if(null===e)return"null";if(void 0===e)return"undefined";var t=typeof e;return"object"===t&&(Array.prototype.isPrototypeOf(e)||e.constructor&&"Array"===e.constructor.name)?"array":"object"===t&&(String.prototype.isPrototypeOf(e)||e.constructor&&"String"===e.constructor.name)?"string":t},t=function(e){return{eq:e}},o=t((function(e,t){return e===t})),n=function(e){return t((function(t,o){if(t.length!==o.length)return!1;for(var n=t.length,r=0;r<n;r++)if(!e.eq(t[r],o[r]))return!1;return!0}))},r=t((function(s,a){if(s===a)return!0;var i,c=e(s);return c===e(a)&&(function(e){return-1!==["undefined","boolean","number","string","function","xml","null"].indexOf(e)}(c)?s===a:"array"===c?n(r).eq(s,a):"object"===c&&(i=r,t((function(e,r){var s=Object.keys(e),a=Object.keys(r);if(!function(e,o){return function(e,o){return t((function(t,n){return e.eq(o(t),o(n))}))}(n(e),(function(e){return function(e,t){return Array.prototype.slice.call(e).sort(t)}(e,o)}))}(o).eq(s,a))return!1;for(var c=s.length,l=0;l<c;l++){var m=s[l];if(!i.eq(e[m],r[m]))return!1}return!0}))).eq(s,a))}));const s=Object.getPrototypeOf,a=(e,t,o)=>{var n;return!!o(e,t.prototype)||(null===(n=e.constructor)||void 0===n?void 0:n.name)===t.name},i=e=>t=>(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&a(e,String,((e,t)=>t.isPrototypeOf(e)))?"string":t})(t)===e,c=e=>t=>typeof t===e,l=e=>t=>e===t,m=i("string"),d=i("object"),u=e=>((e,t)=>d(e)&&a(e,t,((e,t)=>s(e)===t)))(e,Object),_=l(null),v=c("boolean"),p=l(void 0),h=e=>!(e=>null==e)(e),g=c("function"),f=c("number"),y=()=>{},b=e=>()=>e,w=e=>e,x=e=>e(),C=b(!1),S=b(!0);class A{constructor(e,t){this.tag=e,this.value=t}static some(e){return new A(!0,e)}static none(){return A.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?A.some(e(this.value)):A.none()}bind(e){return this.tag?e(this.value):A.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:A.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return h(e)?A.some(e):A.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}A.singletonNone=new A(!1);const k=Array.prototype.slice,D=Array.prototype.indexOf,O=(e,t)=>{return o=e,n=t,D.call(o,n)>-1;var o,n},R=(e,t)=>{const o=e.length,n=new Array(o);for(let r=0;r<o;r++){const o=e[r];n[r]=t(o,r)}return n},E=(e,t)=>{for(let o=0,n=e.length;o<n;o++)t(e[o],o)},T=(e,t)=>{const o=[];for(let n=0,r=e.length;n<r;n++){const r=e[n];t(r,n)&&o.push(r)}return o},M=(e,t)=>((e,t,o)=>{for(let n=0,r=e.length;n<r;n++){const r=e[n];if(t(r,n))return A.some(r);if(o(r,n))break}return A.none()})(e,t,C),N=(e,t)=>t>=0&&t<e.length?A.some(e[t]):A.none(),L=e=>N(e,0),j=e=>{let t=e;return{get:()=>t,set:e=>{t=e}}},P=Object.keys,I=Object.hasOwnProperty,U=(e,t)=>{const o=P(e);for(let n=0,r=o.length;n<r;n++){const r=o[n];t(e[r],r)}},$=(e,t)=>B(e,((e,o)=>({k:o,v:t(e,o)}))),B=(e,t)=>{const o={};return U(e,((e,n)=>{const r=t(e,n);o[r.k]=r.v})),o},H=(e,t)=>{const o={};var n;return((e,t,o,n)=>{U(e,((e,r)=>{(t(e,r)?o:n)(e,r)}))})(e,t,(n=o,(e,t)=>{n[t]=e}),y),o},F=(e,t)=>I.call(e,t),q=e=>parseInt(e,10),Y=(e,t)=>{const o=e-t;return 0===o?0:o>0?1:-1},V=(e,t,o)=>({major:e,minor:t,patch:o}),W=e=>{const t=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(e);return t?V(q(t[1]),q(t[2]),q(t[3])):V(0,0,0)};let z=[],G=(e,t)=>{let o=[],n={get:()=>(n.lc||n.listen((()=>{}))(),n.value),l:t||0,lc:0,listen:(e,t)=>(n.lc=o.push(e,t||n.l)/2,()=>{let t=o.indexOf(e);~t&&(o.splice(t,2),--n.lc||n.off())}),notify(e,t){let r=!z.length;for(let r=0;r<o.length;r+=2)z.push(o[r],o[r+1],n.value,e,t);if(r){for(let e=0;e<z.length;e+=5){let t;for(let o=e+1;!t&&(o+=5)<z.length;)z[o]<z[e+1]&&(t=z.push(z[e],z[e+1],z[e+2],z[e+3],z[e+4]));t||z[e](z[e+2],z[e+3],z[e+4])}z.length=0}},off(){},set(e){let t=n.value;t!==e&&(n.value=e,n.notify(t))},subscribe(e,t){let o=n.listen(e,t);return e(n.value),o},value:e};return n},Q=0;const J=e=>{const t=(new Date).getTime(),o=Math.floor(window.crypto.getRandomValues(new Uint32Array(1))[0]/4294967295*1e9);return Q++,e+"_"+o+Q+String(t)},K="undefined"!=typeof window?window:Function("return this;")(),X=(e,t)=>((e,t)=>{let o=null!=t?t:K;for(let t=0;t<e.length&&null!=o;++t)o=o[e[t]];return o})(e.split("."),t),Z=Object.getPrototypeOf,ee=e=>{const t=X("ownerDocument.defaultView",e);return d(e)&&((e=>((e,t)=>{const o=((e,t)=>X(e,t))(e,t);if(null==o)throw new Error(e+" not available on this browser");return o})("HTMLElement",e))(t).prototype.isPrototypeOf(e)||/^HTML\w*Element$/.test(Z(e).constructor.name))},te=e=>1===(e=>e.dom.nodeType)(e);const oe=e=>t=>te(t)&&t.dom.nodeName.toLowerCase()===e,ne=(e,t,o)=>{if(!(m(o)||v(o)||f(o)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",o,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,o+"")},re=(e,t,o)=>{ne(e.dom,t,o)},se=(e,t)=>{const o=e.dom.getAttribute(t);return null===o?void 0:o},ae=(e,t)=>A.from(se(e,t)),ie=(e,t)=>{e.dom.removeAttribute(t)},ce=(e,t,o=0,n)=>{const r=e.indexOf(t,o);return-1!==r&&(!!p(n)||r+t.length<=n)},le=(e,t)=>((e,t)=>""===t||e.length>=t.length&&e.substr(0,0+t.length)===t)(e,t),me=e=>t=>t.replace(e,""),de=me(/^\s+|\s+$/g),ue=me(/^\s+/g),_e=e=>e.length>0,ve=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},pe=(e,t)=>{const o=(t||document).createElement(e);return ve(o)},he=ve,ge=(e,t)=>{const o=e.dom;if(1!==o.nodeType)return!1;{const e=o;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},fe=e=>1!==e.nodeType&&9!==e.nodeType&&11!==e.nodeType||0===e.childElementCount,ye=e=>A.from(e.dom.parentNode).map(he),be=e=>R(e.dom.childNodes,he),we=()=>xe(he(document)),xe=e=>{const t=e.dom.body;if(null==t)throw new Error("Body is not available yet");return he(t)},Ce=(e,t)=>{e.dom.appendChild(t.dom)},Se=e=>{const t=e.dom;null!==t.parentNode&&t.parentNode.removeChild(t)},Ae=e=>{const t=be(e);var o,n;t.length>0&&(o=e,E(n=t,((e,t)=>{((e,t)=>{const o=(e=>A.from(e.dom.nextSibling).map(he))(e);o.fold((()=>{ye(e).each((e=>{Ce(e,t)}))}),(e=>{((e,t)=>{ye(e).each((o=>{o.dom.insertBefore(t.dom,e.dom)}))})(e,t)}))})(0===t?o:n[t-1],e)}))),Se(e)},ke=(e,t)=>{const o=(e=>he(e.dom.ownerDocument))(e),n=o.dom,r=he(n.createDocumentFragment());((e,t)=>{E(t,(t=>{Ce(e,t)}))})(r,((e,t)=>{const o=(t||document).createElement("div");return o.innerHTML=e,be(he(o))})(t,n)),(e=>{e.dom.textContent="",E(be(e),(e=>{Se(e)}))})(e),Ce(e,r)},De=()=>Oe(0,0),Oe=(e,t)=>({major:e,minor:t}),Re={nu:Oe,detect:(e,t)=>{const o=String(t).toLowerCase();return 0===e.length?De():((e,t)=>{const o=((e,t)=>{for(let o=0;o<e.length;o++){const n=e[o];if(n.test(t))return n}})(e,t);if(!o)return{major:0,minor:0};const n=e=>Number(t.replace(o,"$"+e));return Oe(n(1),n(2))})(e,o)},unknown:De},Ee=(e,t)=>{const o=String(t).toLowerCase();return M(e,(e=>e.search(o)))},Te=/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,Me=e=>t=>ce(t,e),Ne=[{name:"Edge",versionRegexes:[/.*?edge\/ ?([0-9]+)\.([0-9]+)$/],search:e=>ce(e,"edge/")&&ce(e,"chrome")&&ce(e,"safari")&&ce(e,"applewebkit")},{name:"Chromium",brand:"Chromium",versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/,Te],search:e=>ce(e,"chrome")&&!ce(e,"chromeframe")},{name:"IE",versionRegexes:[/.*?msie\ ?([0-9]+)\.([0-9]+).*/,/.*?rv:([0-9]+)\.([0-9]+).*/],search:e=>ce(e,"msie")||ce(e,"trident")},{name:"Opera",versionRegexes:[Te,/.*?opera\/([0-9]+)\.([0-9]+).*/],search:Me("opera")},{name:"Firefox",versionRegexes:[/.*?firefox\/\ ?([0-9]+)\.([0-9]+).*/],search:Me("firefox")},{name:"Safari",versionRegexes:[Te,/.*?cpu os ([0-9]+)_([0-9]+).*/],search:e=>(ce(e,"safari")||ce(e,"mobile/"))&&ce(e,"applewebkit")}],Le=[{name:"Windows",search:Me("win"),versionRegexes:[/.*?windows\ nt\ ?([0-9]+)\.([0-9]+).*/]},{name:"iOS",search:e=>ce(e,"iphone")||ce(e,"ipad"),versionRegexes:[/.*?version\/\ ?([0-9]+)\.([0-9]+).*/,/.*cpu os ([0-9]+)_([0-9]+).*/,/.*cpu iphone os ([0-9]+)_([0-9]+).*/]},{name:"Android",search:Me("android"),versionRegexes:[/.*?android\ ?([0-9]+)\.([0-9]+).*/]},{name:"macOS",search:Me("mac os x"),versionRegexes:[/.*?mac\ os\ x\ ?([0-9]+)_([0-9]+).*/]},{name:"Linux",search:Me("linux"),versionRegexes:[]},{name:"Solaris",search:Me("sunos"),versionRegexes:[]},{name:"FreeBSD",search:Me("freebsd"),versionRegexes:[]},{name:"ChromeOS",search:Me("cros"),versionRegexes:[/.*?chrome\/([0-9]+)\.([0-9]+).*/]}],je={browsers:b(Ne),oses:b(Le)},Pe=e=>{const t=e.current,o=e.version,n=e=>()=>t===e;return{current:t,version:o,isEdge:n("Edge"),isChromium:n("Chromium"),isIE:n("IE"),isOpera:n("Opera"),isFirefox:n("Firefox"),isSafari:n("Safari")}},Ie=()=>Pe({current:void 0,version:Re.unknown()}),Ue=Pe,$e=e=>{const t=e.current,o=e.version,n=e=>()=>t===e;return{current:t,version:o,isWindows:n("Windows"),isiOS:n("iOS"),isAndroid:n("Android"),isMacOS:n("macOS"),isLinux:n("Linux"),isSolaris:n("Solaris"),isFreeBSD:n("FreeBSD"),isChromeOS:n("ChromeOS")}},Be=()=>$e({current:void 0,version:Re.unknown()}),He=$e,Fe=(e,t,o)=>{const n=je.browsers(),r=je.oses(),s=t.bind((e=>((e,t)=>((e,t)=>{for(let o=0;o<e.length;o++){const n=t(e[o]);if(n.isSome())return n}return A.none()})(t.brands,(t=>{const o=t.brand.toLowerCase();return M(e,(e=>{var t;return o===(null===(t=e.brand)||void 0===t?void 0:t.toLowerCase())})).map((e=>({current:e.name,version:Re.nu(parseInt(t.version,10),0)})))})))(n,e))).orThunk((()=>((e,t)=>Ee(e,t).map((e=>{const o=Re.detect(e.versionRegexes,t);return{current:e.name,version:o}})))(n,e))).fold(Ie,Ue),a=((e,t)=>Ee(e,t).map((e=>{const o=Re.detect(e.versionRegexes,t);return{current:e.name,version:o}})))(r,e).fold(Be,He),i=((e,t,o,n)=>{const r=e.isiOS()&&!0===/ipad/i.test(o),s=e.isiOS()&&!r,a=e.isiOS()||e.isAndroid(),i=a||n("(pointer:coarse)"),c=r||!s&&a&&n("(min-device-width:768px)"),l=s||a&&!c,m=t.isSafari()&&e.isiOS()&&!1===/safari/i.test(o),d=!l&&!c&&!m;return{isiPad:b(r),isiPhone:b(s),isTablet:b(c),isPhone:b(l),isTouch:b(i),isAndroid:e.isAndroid,isiOS:e.isiOS,isWebView:b(m),isDesktop:b(d)}})(a,s,e,o);return{browser:s,os:a,deviceType:i}},qe=e=>window.matchMedia(e).matches,Ye=(e=>{let t,o=!1;return(...n)=>(o||(o=!0,t=e.apply(null,n)),t)})((()=>Fe(window.navigator.userAgent,A.from(window.navigator.userAgentData),qe)))().os.isMacOS()?"\u2318":"Ctrl",Ve=$({tc_conversations_title:"Comments",tc_announce_sidebar_available:`Comment. Sidebar available. Press ${Ye} + Alt + M to switch to sidebar`,tc_items_addcomment:"Add comment",tc_items_showcomments:"Show comments",tc_items_deleteall:"Delete all conversations",tc_edit_buttons_save:"Save",tc_edit_buttons_saving:"Saving",tc_edit_buttons_cancel:"Cancel",tc_reply_buttons_comment:"Comment",tc_reply_buttons_clear:"Clear",tc_reply_placeholders:"Add comment...",tc_reply_with_mentions_placeholders:"Comment or mention with @",tc_kebab_tooltip:"Comment Actions",tc_kebab_tooltip_conversation:"Conversation Actions",tc_kebab_delete_conversation:"Delete conversation",tc_kebab_resolve_conversation:"Resolve conversation",tc_kebab_delete:"Delete",tc_kebab_edit:"Edit",tc_edit_problem_comment:"An error occurred editing this comment. See the console for details.",tc_edit_unauthorised_comment:"You are not allowed to edit this comment",tc_delete_buttons_cancel:"Cancel",tc_delete_buttons_proceed:"Delete",tc_resolve_buttons_proceed:"Resolve",tc_resolve_buttons_cancel:"Cancel",tc_create_problem:"An error occurred while creating a comment. See the console for details",tc_reply_problem:"An error occurred while replying to a comment. See the console for details",tc_delete_prompts_conversation:"Delete this conversation?",tc_delete_prompts_conversation_detail_sing:"1 comment will be deleted. You can't undo this action.",tc_delete_prompts_conversation_detail_pl:"{0} comments will be deleted. You can't undo this action.",tc_delete_prompts_all:"Delete all conversations in the content? This cannot be undone.",tc_delete_prompts_comment:"Are you sure you want to delete this comment?",tc_resolve_prompts_conversation:"Resolve this conversation?",tc_resolve_prompts_conversation_detail_sing:"1 comment will be resolved. You can't undo this action.",tc_resolve_prompts_conversation_detail_pl:"{0} comments will be resolved. You can't undo this action.",tc_delete_problem_all:"An error occurred deleting all the conversations. See the console for details.",tc_delete_problem_conversation:"An error occurred deleting the conversation. See the console for details.",tc_delete_problem_comment:"An error occurred deleting the comment. See the console for details.",tc_delete_unauthorised_all:"You are not allowed to delete all the conversations",tc_delete_unauthorised_conversation:"You are not allowed to delete this conversation",tc_delete_unauthorised_comment:"You are not allowed to delete this comment",tc_resolve_unauthorised_conversation:"You are not allowed to resolve this conversation",tc_resolve_problem_conversation:"An error occurred resolving the conversation. See the console for details.",tc_date_less_than_a_minute_ago:"a moment ago",tc_date_1_minute_ago:"1 minute ago",tc_date_x_minutes_ago:"{0} minutes ago",tc_date_1_hour_ago:"1 hour ago",tc_date_x_hours_ago:"{0} hours ago",tc_date_1_day_ago:"1 day ago",tc_date_x_days_ago:"{0} days ago",tc_date_1_week_ago:"1 week ago",tc_date_x_weeks_ago:"{0} weeks ago",tc_date_1_month_ago:"1 month ago",tc_date_x_months_ago:"{0} months ago",tc_date_1_year_ago:"1 year ago",tc_date_x_years_ago:"{0} years ago",tc_date_comment_edited:" (edited)",tc_conversations_one_reply:"1 reply",tc_conversations_multiple_replies:"{0} replies",tc_dialog_delete_conversation:"Delete Conversation",tc_dialog_resolve_conversation:"Resolve Conversation",tc_dialog_delete_comment:"Delete Comment",tc_mentions_no_results:"No users found"},w),We=J("aria-comment-description");let ze=0;const Ge=e=>{const t=(o=we(),n=`#${We}`,((e,t)=>{const o=void 0===t?document:t.dom;return fe(o)?A.none():A.from(o.querySelector(e)).map(he)})(n,o)).getOrThunk((()=>{const e=pe("span");return((e,t)=>{const o=e.dom;U(t,((e,t)=>{ne(o,t,e)}))})(e,{id:We,"aria-live":"polite","aria-atomic":"true",role:"alert"}),(e=>{const t=e.dom;U({position:"absolute",left:"-10000px",top:"-1000px"},((e,o)=>{((e,t,o)=>{if(!m(o))throw console.error("Invalid call to CSS.set. Property ",t,":: Value ",o,":: Element ",e),new Error("CSS value must be a string: "+o);(e=>void 0!==e.style&&g(e.style.getPropertyValue))(e)&&e.style.setProperty(t,o)})(t,o,e)}))})(e),Ce(we(),e),e}));var o,n;return ze++,((e,t)=>({onComment:()=>{ke(t,e.translate(Ve.tc_announce_sidebar_available))},notOnComment:()=>{ke(t,"")},getMarker:()=>t,release:()=>{ze--,0===ze&&Se(t)}}))(e,t)},Qe=()=>(new Date).toISOString();var Je;!function(e){e[e.LessThanMinute=0]="LessThanMinute",e[e.Minute=1]="Minute",e[e.Hour=2]="Hour",e[e.Day=3]="Day",e[e.Week=4]="Week",e[e.Month=5]="Month",e[e.Year=6]="Year"}(Je||(Je={}));const Ke=(e,t="")=>{const o=e.get(),n=""===t?0:Date.parse(t);return{timestamp:Qe(),events:n>0?T(o,(e=>Date.parse(e.timestamp)>n)):o}},Xe=e=>(t={})=>m(t.after)?Ke(e,t.after):Ke(e),Ze=(e,t)=>((e,t)=>{const o=void 0===t?document:t.dom;return fe(o)?[]:R(o.querySelectorAll(e),he)})(t,e),et=b("tox-comment"),tt=b("tinycomments"),ot=b("mce-annotation"),nt=b("data-mce-annotation"),rt=b("data-mce-annotation-uid"),st=b("data-mce-annotation-active"),at=b("data-mce-annotation-classes"),it=b("data-mce-annotation-attrs"),ct=b("tmp"),lt=b("tox-comments-visible"),mt=e=>P(e.annotator.getAll(tt())),dt=e=>le(e,ct()),ut=(e,t)=>{const o=he(t.commonAncestorContainer),n=te(r=o)&&ee(r.dom)?A.some(o):(e=>A.from(e.dom.parentElement).map(he))(o);var r;const s=`[${nt()}="${tt()}"]`,a=n.map((e=>Ze(e,s))).getOr([]),i=(e=>{const t=k.call(e,0);return t.reverse(),t})(((t,o)=>((e,t,o)=>T(((e,t)=>{const o=g(t)?t:C;let n=e.dom;const r=[];for(;null!==n.parentNode&&void 0!==n.parentNode;){const e=n.parentNode,t=he(e);if(r.push(t),!0===o(t))break;n=e}return r})(e,o),t))(t,(e=>ge(e,o)),(t=>t.dom===e.getBody())))(o,s));return ge(o,s)&&i.push(o),T(i.concat(a),(e=>{return!(se(o=e,nt())===tt()&&ae(o,rt()).exists(dt))&&((e,t)=>e.intersectsNode(t.dom))(t,e);var o}))},_t=oe("hr"),vt=e=>{const t=he(e.selection.getNode()),o=he(e.selection.getStart());return(e=>{let t=e.selection.getRng().commonAncestorContainer;return 3===t.nodeType&&(t=t.parentNode),!!h(t)&&e.dom.isEmpty(t)})(e)||_t(t)||_t(o)},pt=(e,t)=>vt(e)||!(e=>{if(e.selection){const t=e.selection.getRng(),o=ut(e,t);return L(o).forall((e=>{return(n=o,N(n,n.length-1)).forall((n=>{const r=se(e,rt());if((e=>{for(let o=0,n=e.length;o<n;o++)if(t=e[o],se(t,rt())!==r)return!0;var t;return!1})(o))return!1;const s=new window.Range;return s.setStartBefore(e.dom),s.setEndAfter(n.dom),s.compareBoundaryPoints(window.Range.START_TO_START,t)<=0&&s.compareBoundaryPoints(window.Range.END_TO_END,t)>=0}));var n}))}return!1})(e)||!t.get().canWrite,ht=(e,t)=>{const o=se(e,t);return void 0===o||""===o?[]:o.split(" ")},gt=e=>void 0!==e.dom.classList,ft=(e,t)=>{gt(e)?e.dom.classList.remove(t):((e,t)=>{((e,t,o)=>{const n=T(ht(e,t),(e=>e!==o));n.length>0?re(e,t,n.join(" ")):ie(e,t)})(e,"class",t)})(e,t),(e=>{const t=gt(e)?e.dom.classList:(e=>ht(e,"class"))(e);0===t.length&&ie(e,"class")})(e)},yt=oe("span"),bt=e=>{yt(e)?Ae(e):(e=>{ft(e,ot()),ie(e,`${rt()}`),ie(e,`${nt()}`),ie(e,`${st()}`);const t=ae(e,`${it()}`).map((e=>e.split(","))).getOr([]),o=ae(e,`${at()}`).map((e=>e.split(","))).getOr([]);E(t,(t=>ie(e,t))),((e,t)=>{E(t,(t=>{ft(e,t)}))})(e,o),ie(e,`${at()}`),ie(e,`${it()}`)})(e)},wt=(e,t,o,n)=>(ke(e,t),E(Ze(e,o),n),e.dom.innerHTML),xt=(e,t,o)=>{const n=pe("div");E(e,(e=>{if(e.content=wt(n,e.content,t,o),h(e.fragments))for(let r=0;r<e.fragments.length;r++)e.fragments[r]=wt(n,e.fragments[r],t,o)}))},Ct=(e,t,o)=>{e.notificationManager.open({text:t,type:"error"}),o&&console.error(m(o)?o:o.message,o)},St="tc-try-delete-all-conversations",At=(e,t)=>{e.addCommand("tc-delete-conversation-at-cursor",((o,n)=>{if(vt(e))return;const r=(null==n?void 0:n.conversationUid)?A.from(n.conversationUid):(e=>{const t=H(e.annotator.getAll(tt()),(t=>O(t,e.selection.getNode())));return L(P(t))})(e);r.each((o=>{var n;e.undoManager.transact((()=>e.annotator.remove(tt()))),n=e.undoManager.data,xt(n,(e=>`[${rt()}="${e}"]`)(o),bt),t.set(t.get().filter((e=>e!==o))),e.focus()}))}))},kt=(e,t,o,n)=>{At(e,n),((e,t,o,n)=>{e.addCommand(St,(()=>{vt(e)||e.windowManager.confirm(Ve.tc_delete_prompts_all,(r=>{if(r)return t.deleteAllConversations({}).get((t=>{t.fold((t=>Ct(e,Ve.tc_delete_problem_all,t)),(t=>{var r;t.canDelete?(o({type:"delete-all-conversations",timestamp:Qe()}),e.annotator.removeAll(tt()),r=e.undoManager.data,xt(r,`[${nt()}="${tt()}"]`,bt),e.undoManager.dispatchChange(),n.set([]),e.focus()):Ct(e,Ve.tc_delete_unauthorised_all)}))}))}))}))})(e,t,o,n)},Dt=e=>{e.execCommand("ToggleSidebar",!1,"showcomments")},Ot=e=>{let t=A.none(),o=[];const n=e=>{r()?s(e):o.push(e)},r=()=>t.isSome(),s=e=>{t.each((t=>{setTimeout((()=>{e(t)}),0)}))};return e((e=>{r()||(t=A.some(e),E(o,s),o=[])})),{get:n,map:e=>Ot((t=>{n((o=>{t(e(o))}))})),isReady:r}},Rt={nu:Ot,pure:e=>Ot((t=>{t(e)}))},Et=e=>{setTimeout((()=>{throw e}),0)},Tt=e=>{const t=t=>{e().then(t,Et)};return{map:t=>Tt((()=>e().then(t))),bind:t=>Tt((()=>e().then((e=>t(e).toPromise())))),anonBind:t=>Tt((()=>e().then((()=>t.toPromise())))),toLazy:()=>Rt.nu(t),toCached:()=>{let t=null;return Tt((()=>(null===t&&(t=e()),t)))},toPromise:e,get:t}},Mt=e=>Tt((()=>new Promise(e))),Nt=e=>Tt((()=>Promise.resolve(e))),Lt=e=>{const t=t=>t(e),o=b(e),n=()=>r,r={tag:!0,inner:e,fold:(t,o)=>o(e),isValue:S,isError:C,map:t=>Pt.value(t(e)),mapError:n,bind:t,exists:t,forall:t,getOr:o,or:n,getOrThunk:o,orThunk:n,getOrDie:o,each:t=>{t(e)},toOptional:()=>A.some(e)};return r},jt=e=>{const t=()=>o,o={tag:!1,inner:e,fold:(t,o)=>t(e),isValue:C,isError:S,map:t,mapError:t=>Pt.error(t(e)),bind:t,exists:C,forall:S,getOr:w,or:w,getOrThunk:x,orThunk:x,getOrDie:(n=String(e),()=>{throw new Error(n)}),each:y,toOptional:A.none};var n;return o},Pt={value:Lt,error:jt,fromOption:(e,t)=>e.fold((()=>jt(t)),Lt)},It=e=>({...e,toCached:()=>It(e.toCached()),bindFuture:t=>It(e.bind((e=>e.fold((e=>Nt(Pt.error(e))),(e=>t(e)))))),bindResult:t=>It(e.map((e=>e.bind(t)))),mapResult:t=>It(e.map((e=>e.map(t)))),mapError:t=>It(e.map((e=>e.mapError(t)))),foldResult:(t,o)=>e.map((e=>e.fold(t,o))),withTimeout:(t,o)=>It(Mt((n=>{let r=!1;const s=setTimeout((()=>{r=!0,n(Pt.error(o()))}),t);e.get((e=>{r||(clearTimeout(s),n(e))}))})))}),Ut=e=>It(Nt(Pt.value(e))),$t=e=>It(Mt(e)),Bt=Ut,Ht=Ut,Ft=e=>It(Nt(Pt.error(e))),qt=e=>t=>$t((o=>e(t,(e=>{o(Pt.value(e))}),(e=>{o(Pt.error(e))})))),Yt=e=>t=>t.options.get(e),Vt=e=>t=>A.from(Yt(e)(t)).filter(g),Wt=e=>t=>Vt(e)(t).getOrDie(e+" has not been implemented."),zt=(e,t)=>o=>{var n;return null!==(n=o.options.get(e))&&void 0!==n?n:t(o)},Gt=(e,t)=>o=>{const n=zt(e,(()=>t(so(o))))(o);return qt(n)},Qt=Wt("tinycomments_create"),Jt=Wt("tinycomments_reply"),Kt=Wt("tinycomments_delete"),Xt=Vt("tinycomments_resolve"),Zt=Wt("tinycomments_delete_all"),eo=Wt("tinycomments_delete_comment"),to=Wt("tinycomments_edit_comment"),oo=Wt("tinycomments_lookup"),no=Vt("tinycomments_fetch"),ro=Vt("tinycomments_fetch_author_info"),so=Yt("tinycomments_author"),ao=zt("tinycomments_author_name",so),io=Yt("tinycomments_author_avatar"),co=Gt("tinycomments_can_delete",(e=>(t,o,n)=>{o({canDelete:t.comments.length>0&&t.comments[0].author===e&&!0})})),lo=Vt("tinycomments_can_resolve"),mo=Gt("tinycomments_can_delete_comment",(e=>(t,o,n)=>{o({canDelete:t.comment.author===e&&!0})})),uo=Gt("tinycomments_can_edit_comment",(e=>(t,o,n)=>{o({canEdit:t.comment.author===e&&!0})})),_o=Yt("tinycomments_access"),vo=Yt("tinycomments_mode"),po=Yt("tinycomments_css_url"),ho=Yt("tinycomments_js_url"),go=Yt("disabled"),fo=(yo=(e,t)=>u(e)&&u(t)?fo(e,t):t,(...e)=>{if(0===e.length)throw new Error("Can't merge zero objects");const t={};for(let o=0;o<e.length;o++){const n=e[o];for(const e in n)F(n,e)&&(t[e]=yo(t[e],n[e]))}return t});var yo;const bo=e=>{const t=Qt(e),o=Jt(e),n=oo(e),r=no(e),s=(e=>ro(e).map((e=>(t,o,n)=>e(o,n))))(e),a=Kt(e),i=Xt(e),c=Zt(e),l=eo(e),m=to(e);return{create:qt(t),reply:qt(o),lookup:qt((d=n,(e,t,o)=>{d(e,(e=>{const o=R(e.conversation.comments,(e=>({authorName:e.author,...e})));t(fo(e,{conversation:{comments:o}}))}),o)})),fetchConversations:r.map((e=>qt(e))),fetchAuthorInfo:s.map((e=>qt(e))),deleteConversation:qt(a),resolveConversation:i.map((e=>qt(e))),deleteAllConversations:qt(c),editComment:qt(m),deleteComment:qt(l),lifecycleHooks:{onPreInit:y,onGetContent:A.none}};var d},wo={base64:{versions:["2.0","2.1"],encryptor:{encryptText:e=>{const t=new Blob([e],{type:"application/json"}),o=new FileReader;return $t((e=>{o.addEventListener("loadend",(()=>e(Pt.value({encrypted:[o.result]})))),o.addEventListener("error",(()=>e(Pt.error(o.error||new Error("error decoding text"))))),o.readAsDataURL(t)}))},decryptText:e=>{return(t=e[0],(e=>{const t=e.split(","),o=/data:([^;]+)/.exec(t[0]);if(!o)return A.none();const n=o[1],r=t[1],s=1024,a=atob(r),i=a.length,c=Math.ceil(i/s),l=new Array(c);for(let e=0;e<c;++e){const t=e*s,o=Math.min(t+s,i),n=new Array(o-t);for(let e=t,r=0;e<o;++r,++e)n[r]=a[e].charCodeAt(0);l[e]=new Uint8Array(n)}return A.some(new Blob(l,{type:n}))})(t)).fold((()=>Ft("Could not decode URI")),(e=>{const t=new FileReader;return $t((o=>{t.addEventListener("loadend",(()=>o(Pt.value({decrypted:t.result})))),t.addEventListener("error",(()=>{var e;return o(Pt.error((null===(e=t.error)||void 0===e?void 0:e.message)||"error decoding text"))})),t.readAsText(e)}))}));var t}}}};wo.current=wo.base64;const xo=(e,t,o)=>t===e?o:"2.0"===e?xo("2.1",t,(e=>({...e,authorName:e.author}))(o)):o,Co="tinycomments",So="2.1",Ao=e=>le(ue(e),Co),ko=e=>{const t=de(e).split("|");return t.length>2?Pt.value({version:t[1],rest:t.slice(2)}):Pt.error("Embedded comments not in expected format.")},Do=(e,t,o)=>((e,t)=>{const o=(e=>{try{const t=JSON.parse(e);return Pt.value(t)}catch(e){return Pt.error("Could not JSON parse conversations.")}})(t);return e!==So?o.map((t=>$(t,(t=>({...t,comments:R(t.comments,(t=>xo(e,So,t)))}))))):o})(e,o).map((e=>({conversations:e,encrypted:{encrypted:t}}))),Oo=e=>Ao(e)?ko(e).fold((e=>Ft(e)),(({version:e,rest:t})=>((e,t)=>(e=>((e,t)=>{const o=P(e);for(let n=0,r=o.length;n<r;n++){const r=e[o[n]];if(t(r))return A.some(r)}return A.none()})(wo,(t=>O(t.versions,e))).map((e=>e.encryptor)))(e).fold((()=>Ft(`No Encryptor for version: ${e}`)),(e=>e.decryptText(t))))(e,t).bindResult((({decrypted:o})=>Do(e,t,o))))):Ht({conversations:{},encrypted:{encrypted:[]}}),Ro=e=>{const t=so(e),o=ao(e),n=io(e),r=(()=>{let e={},t=A.none();const o=t=>Object.prototype.hasOwnProperty.call(e,t)?A.some(e[t]):A.none();return{get:()=>fo(e,{}),clear:()=>{e={},t=A.none()},addData:(t,o)=>{e[t]=o},setData:(o,n)=>{e=o,t=A.some(n)},setEncryptedData:e=>{t=A.some(e)},getEncryptedData:()=>t,lookupData:o,removeData:t=>{delete e[t]},updateData:(t,n)=>o(t).map((o=>{const r=n(o);return e[t]=r,r}))}})(),s=co(e),a=mo(e),i=uo(e),c=lo(e).map((e=>qt(e))),l={author:t,authorName:o},m=H({authorAvatar:n},(e=>!p(e))),d=wo.current.encryptor,u=()=>d.encryptText(JSON.stringify(r.get())).mapResult((e=>r.setEncryptedData(e))),_=A.some((e=>{return Bt({conversations:(t=e,o=(e,t)=>({...e,[t]:r.get()[t]}),n={},E(t,((e,t)=>{n=o(n,e)})),n)});var t,o,n})),v=A.some((()=>Bt({author:t,authorName:o,authorAvatar:n}))),h=c.map((e=>t=>r.lookupData(t.conversationUid).fold((()=>Ft("Could not find conversation to resolve")),(o=>e({conversationUid:o.uid,comments:o.comments}).bindFuture((e=>e.canResolve?(r.removeData(t.conversationUid),u().mapResult((()=>({canResolve:!0})))):Ht({canResolve:!1}))))))),g=(e,t,o,n)=>(e=>r.lookupData(e.conversationUid).fold((()=>Pt.error(`Could not find conversation with uid ${e.conversationUid}`)),(t=>M(t.comments,(t=>t.uid===e.commentUid)).fold((()=>Pt.error(`Could not find comment with uid ${e.commentUid} in conversation ${e.conversationUid}`)),(e=>Pt.value({conversationUid:t.uid,comment:e}))))))(e).fold((e=>Ft(e)),(s=>o(s).bindFuture((o=>!0===o[t]?r.updateData(e.conversationUid,n(s)).fold((()=>Ft("Could not operate on comment ("+t+")")),(e=>u().mapResult((()=>({[t]:!0}))))):Ht({[t]:!1}))))),f={onPreInit:t=>{e.parser.addNodeFilter("#comment",((t,o,n)=>{n.isRootContent&&(r.clear(),E(t,(t=>{const o=t.value;o&&Ao(o)&&(t.remove(),ko(o).each((e=>r.setEncryptedData({encrypted:e.rest}))),Oo(o).get((t=>t.fold((e=>console.error("Error extracting embedded conversations: "+e)),(t=>{r.setData(t.conversations,t.encrypted),(e=>{e.dispatch("mce-tinycomments-update",{})})(e)})))))})))}))},onGetContent:(e,t)=>r.getEncryptedData().map((e=>t+(e=>{const t=he(document.createComment((e=>[Co,So,...e.encrypted].join("|"))(e)));return(e=>{const t=pe("div"),o=he(e.dom.cloneNode(!0));return Ce(t,o),(e=>e.dom.innerHTML)(t)})(t)})(e)))};return{create:e=>{const t=J("mce-conversation");return r.addData(t,{uid:t,comments:[{uid:t,...l,...m,content:e.content,createdAt:e.createdAt,modifiedAt:e.createdAt}]}),u().mapResult((()=>({conversationUid:t})))},reply:e=>{const t=J("mce-reply"),o={uid:t,...l,...m,content:e.content,createdAt:e.createdAt,modifiedAt:e.createdAt};return r.updateData(e.conversationUid,(e=>({...e,comments:e.comments.concat([o])}))).fold((()=>Ft("Could not reply to uid: "+e.conversationUid)),(()=>u().mapResult((()=>({commentUid:t,author:o.author,authorName:o.authorName})))))},lookup:e=>r.lookupData(e.conversationUid).fold((()=>Ft("Could not find uid: "+e.conversationUid)),(e=>Ht({conversation:e}))),fetchConversations:_,fetchAuthorInfo:v,deleteConversation:e=>r.lookupData(e.conversationUid).fold((()=>Ft("Could not find conversation to delete")),(t=>s({conversationUid:t.uid,comments:t.comments}).bindFuture((t=>t.canDelete?(r.removeData(e.conversationUid),u().mapResult((()=>({canDelete:!0})))):Ht({canDelete:!1}))))),resolveConversation:h,deleteAllConversations:()=>{const e=P(r.get()),t=R(e,(e=>r.lookupData(e).fold((()=>Ft("Could not find conversation")),(e=>s({conversationUid:e.uid,comments:e.comments})))));return $t((e=>{var o;(o=t,((e,t)=>t((t=>{const o=[];let n=0;0===e.length?t([]):E(e,((r,s)=>{r.get((r=>s=>{o[r]=s,n++,n>=e.length&&t(o)})(s))}))})))(o,Mt)).get((t=>{const o=(e=>{for(let t=0,o=e.length;t<o;++t)if(!0!==e[t].exists((e=>e.canDelete)))return!1;return!0})(t);o&&r.clear(),e(Pt.value({canDelete:o}))}))}))},deleteComment:e=>g(e,"canDelete",a,(e=>{return t=e.comment.uid,e=>({uid:e.uid,comments:T(e.comments,(e=>e.uid!==t))});var t})),editComment:e=>g(e,"canEdit",(t=>i({...t,edit:{modifiedAt:e.modifiedAt,content:e.content}})),(()=>{return t=e.commentUid,o=e.content,n=e.modifiedAt,e=>({uid:e.uid,comments:R(e.comments,(e=>e.uid===t?{...e,content:o,modifiedAt:n}:e))});var t,o,n})),lifecycleHooks:f}},Eo=(e,t)=>{if(go(e))return"disabled";const o=_o(e);return"readonly"===t&&"full"===o?"read":o};var To,Mo;!function(e){e[e.Before=0]="Before",e[e.QueryingDelete=1]="QueryingDelete",e[e.QueryingResolve=2]="QueryingResolve",e[e.PostDelete=3]="PostDelete",e[e.PostResolve=4]="PostResolve"}(To||(To={})),function(e){e[e.Open=0]="Open",e[e.Closed=1]="Closed",e[e.Closing=2]="Closing"}(Mo||(Mo={}));const No=e=>{return((e=(()=>he(document))())=>A.from(e.dom.activeElement).map(he))((t=e,he(t.dom.getRootNode()))).filter((t=>e.dom.contains(t.dom)));var t},Lo="tox-button--naked",jo="tox-button--icon",Po="tox-icon",Io="tox-button",Uo="tox-menu",$o="tox-collection",Bo="tox-collection--list",Ho="tox-collection__group",Fo="tox-menu-nav__js",qo="tox-collection__item-container",Yo="tox-collection__item",Vo="tox-collection__item--state-disabled",Wo="tox-mentions__username",zo="tox-conversations",Go=e=>`.${e}`;[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_edit})`].join(" "),[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_delete})`].join(" "),[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_delete_conversation})`].join(" "),[".tox-menu",`[role="menuitem"]:contains(${Ve.tc_kebab_resolve_conversation})`].join(" "),Ve.tc_edit_buttons_save,Ve.tc_edit_buttons_saving,Ve.tc_reply_placeholders,Ve.tc_edit_buttons_cancel,Ve.tc_reply_buttons_clear,Ve.tc_delete_buttons_proceed,Ve.tc_resolve_buttons_proceed,[Go(Vo),Go(Wo)+`:contains(${Ve.tc_mentions_no_results})`].join(" ");const Qo=e=>e.join(" "),Jo={skeleton:Qo(["tox-skeleton"]),skeletonLine:Qo(["tox-skeleton__line"]),skeletonCircle:Qo(["tox-skeleton__circle"]),conversationsTitle:Qo(["tox-conversations__title"]),conversationsHead:Qo(["tox-conversations__header"]),outerContainer:Qo([zo]),date:Qo(["tox-comment__date"]),replySection:Qo(["tox-comment__reply"]),replyTextarea:Qo(["tox-textarea"]),textarea:Qo([]),editTextarea:Qo([]),kebab:Qo([Lo,"tox-button--kebab",Io,jo]),kebabIcon:Qo([Po]),card:Qo(["tox-comment"]),cardHead:Qo(["tox-comment__header"]),cardHeadMeta:Qo(["tox-comment__meta"]),cardBody:Qo(["tox-comment__body"]),cardOverlay:Qo(["tox-comment__overlay"]),cardOverlayText:Qo(["tox-comment__overlaytext"]),cardOverlayButtons:Qo(["tox-comment__buttonspacing"]),mentionsItem:Qo(["tox-mentions-dropdown--menu-item"]),mentionsUser:Qo(["tox-mentions-user"]),button:Qo([Io]),secondaryButton:Qo([Io,"tox-button--secondary"]),editActions:Qo(["tox-comment__edit"]),outerScroll:Qo(["tox-comment__scroll"]),commentList:Qo(["tox-comment-thread"]),comment:Qo(["tox-comment__single"]),avatar:Qo(["tox-user__avatar"]),username:Qo(["tox-user__name"]),user:Qo(["tox-user"]),showMoreLess:Qo([]),kebabItem:Qo([Yo]),kebabItemLabel:Qo(["tox-collection__item-label"]),kebabDisabledItem:Qo([Vo]),kebabMenu:Qo([Uo,$o,Bo]),kebabMenuGroup:Qo([Ho]),roots:Qo([zo]),mentionsButton:Qo([Io,Lo,jo]),mentionsButtonIcon:Qo([Po]),mentionsDropdownContainer:Qo(["tox-autocompleter"]),mentionsDropdownList:Qo([Uo,$o,Bo]),mentionsDropdownGroup:Qo([Ho]),mentionsDropdownItem:Qo([Fo,Yo]),mentionsDropdownItemActive:Qo(["tox-collection__item--active"]),mentionsDropdownItemDisabled:Qo([Fo,Yo,Vo]),mentionsDropdownItemRow:Qo([qo,"tox-collection__item-container--row"]),mentionsDropdownItemColumn:Qo([qo,"tox-collection__item-container--column","tox-collection__item-container--align-left","tox-collection__item-container--valign-middle"]),mentionsDropdownItemAvatar:Qo(["tox-mentions__avatar"]),mentionsDropdownItemName:Qo([Wo]),mentionsDropdownItemDescription:Qo(["tox-mentions__description"])},Ko=(e,t,o,n,r,s,a,i,c,l,m,d)=>u=>{var _,v;if(t.set(Mo.Open),_=he(e.getBody()),v=lt(),gt(_)?_.dom.classList.add(v):((e,t)=>{((e,t,o)=>{const n=ht(e,t).concat([o]);re(e,t,n.join(" "))})(e,"class",t)})(_,v),a.set(mt(e)),o.get()){const t=document.createElement("div");t.className=Jo.outerContainer,u.element().append(t),m.then((()=>l.then((o=>{const l=o(e,n,r,s,a,i,c,d,t);e.on("remove",l)})))),o.set(!1)}},Xo=(e,t)=>o=>{No(he(o.element())).each((t=>{e.focus()})),t.set(Mo.Closed),ft(he(e.getBody()),lt())},Zo=(e,t,o)=>{t.get()!==Mo.Closed&&t.get()!==Mo.Closing||Dt(e),o.set(mt(e))},en=(e,t,o,n,r)=>{r.set(!0),n.set(!1),Zo(e,t,o)},tn=(e,t,o,n,r,s,a)=>{const i="comment-add";e.ui.registry.addToggleMenuItem("showcomments",{text:Ve.tc_items_showcomments,icon:"comment",onAction:()=>Dt(e),onSetup:e=>o.subscribe((t=>{e.setActive(t===Mo.Open)})),context:"any"});const c=t=>{const o=()=>{t(!pt(e,a))};return o(),e.on("SelectionChange NodeChange SwitchMode DisabledStateChange",o),()=>e.off("SelectionChange NodeChange SwitchMode DisabledStateChange",o)},l=()=>{pt(e,a)||((e=>!!e.selection&&ut(e,e.selection.getRng()).length>0)(e)?en(e,o,s,n,r):((e=>{const t=J(ct());e.selection.expand(),(e=>{const t=e.selection.bookmarkManager.getBookmark();U(e.annotator.getAll(tt()),((t,o)=>{dt(o)&&t.forEach((t=>{e.selection.select(t),e.annotator.remove(tt())}))})),e.selection.bookmarkManager.moveToBookmark(t)})(e),e.annotator.annotate(tt(),{uid:t})})(e),((e,t,o,n,r)=>{r.set(!1),n.set(!0),Zo(e,t,o)})(e,o,s,n,r)))};e.ui.registry.addButton("addcomment",{tooltip:Ve.tc_items_addcomment,icon:i,onAction:l,onSetup:e=>c(e.setEnabled),context:"any"}),e.ui.registry.addMenuItem("addcomment",{text:Ve.tc_items_addcomment,shortcut:"meta+Alt+M",icon:i,onAction:l,onSetup:e=>c(e.setEnabled),context:"any"}),e.ui.registry.addMenuItem("deleteallconversations",{text:Ve.tc_items_deleteall,onAction:()=>{(e=>{e.execCommand(St,!1,{})})(e)},onSetup:t=>{const o=e.annotator.getAll(tt());return t.setEnabled(!(e=>{for(const t in e)if(I.call(e,t))return!1;return!0})(o)&&a.get().canWrite),y},context:"any"}),e.shortcuts.add("meta+alt+m","TinyComments addComment",(()=>{const t=H(e.annotator.getAll(tt()),(t=>t.includes(e.selection.getNode())));L(P(t)).fold((()=>l()),(()=>en(e,o,s,n,r)))}))},on=(e,t)=>{const s=j(!1),a=j([]),i=G([]),c=G(Mo.Closed),l=G(Eo(e,e.mode.get())),d=((e,t)=>{let o;Array.isArray(e)||(e=[e]);let n=0,r=()=>{let r=e.map((e=>e.get()));if(void 0===o||r.some(((e,t)=>e!==o[t]))){let e=++n;o=r;let a=t(...r);a&&a.then&&a.t?a.then((t=>{e===n&&s.set(t)})):s.set(a)}},s=G(void 0,Math.max(...e.map((e=>e.l)))+1),a=r;var i,c,l,m,d;return c=()=>{let t=e.map((e=>e.listen(a,-1/s.l)));return r(),()=>{for(let e of t)e()}},m=e=>{let t=c();t&&i.events[6].push(t)},d=e=>{let t=i.listen;i.listen=(...o)=>(i.lc||i.active||(i.active=!0,e()),t(...o));let o=i.off;return i.events[6]=[],i.off=()=>{o(),setTimeout((()=>{if(i.active&&!i.lc){i.active=!1;for(let e of i.events[6])e();i.events[6]=[]}}),1e3)},()=>{i.listen=t,i.off=o}},(l=i=s).events=l.events||{},l.events[15]||(l.events[15]=d((e=>{l.events[5].reduceRight(((e,t)=>(t(e),e)),{shared:{},...e})}))),l.events[5]=l.events[5]||[],l.events[5].push(m),s})(l,(e=>{return t=e,{canWrite:(()=>{switch(t){case"read":case"disabled":return!1;default:return!0}})()};var t})),u=G(!1),v=G(!1),p=((e,t)=>o=>{const n=Xe(t);t.set(t.get().concat([o])),((e,t)=>{const o={getEventLog:t};e.dispatch("CommentChange",o)})(e,n)})(e,a);((e,t)=>{const o=e.options.register;o("tinycomments_css_url",{processor:"string",default:t+"/css"}),o("tinycomments_js_url",{processor:"string",default:t+"/js"}),o("tinycomments_mode",{processor:"string",default:"callback"}),o("tinycomments_access",{processor:e=>{const t=O(["full","comment"],e);return t?{value:e,valid:t}:{valid:!1,message:"Must be full, or comment."}},default:"full"}),o("tinycomments_author",{processor:e=>{const t="Must be a non-empty string";return m(e)?_e(e)?{valid:!0,value:e}:{valid:!1,value:"Anon",message:t}:{valid:!1,message:t}},default:"Anon"}),o("tinycomments_author_name",{processor:e=>{const t="Must be a non-empty string";return m(e)?_e(e)?{valid:!0,value:e}:{valid:!1,value:"Anon",message:t}:{valid:!1,message:t}}}),o("tinycomments_author_avatar",{processor:"string"}),o("tinycomments_mentions_enabled",{processor:"boolean",default:!0}),E(["tinycomments_create","tinycomments_reply","tinycomments_lookup","tinycomments_fetch","tinycomments_delete","tinycomments_delete_all","tinycomments_delete_comment","tinycomments_can_delete","tinycomments_can_delete_comment","tinycomments_resolve","tinycomments_can_resolve","tinycomments_edit_comment","tinycomments_can_edit_comment","tinycomments_fetch_author_info"],(e=>o(e,{processor:"function"})))})(e,t);const h=(e=>("embedded"===vo(e)?Ro:bo)(e))(e),g={translate:e=>tinymce.translate(e),getIcon:t=>{var o;return null!==(o=e.ui.registry.getAll().icons[t])&&void 0!==o?o:"temporary-placeholder"}},f=((e,t)=>tinymce.Resource.load("tinymce.plugins.tinycomments.sidebar",t))(0,(e=>ho(e)+"/")(e)+"tinycomments-sidebar.min.js").then((e=>(s.set(!0),e))),y=Ge(g);e.on("remove",y.release),e.on("PreInit",(()=>{h.lifecycleHooks.onPreInit(e),((e,t)=>{e.annotator.register(tt(),{decorate:()=>({classes:[et()],attributes:{}})}),e.annotator.annotationChanged(tt(),((e,o,n)=>{n&&dt(n.uid)||(e?t.onComment():t.notOnComment())}))})(e,y)})),kt(e,h,p,i),tn(e,0,c,u,v,i,d),((e,t,o,n,r,s,a,i,c,l)=>{const m=j(!0),d=new Promise((t=>{e.initialized?t():e.on("init",(()=>{t()}),!0)}));e.ui.registry.addSidebar("showcomments",{tooltip:Ve.tc_items_showcomments,icon:"comment",onShow:Ko(e,s,m,t,o,n,l,a,i,r,d,c),onHide:Xo(e,s)})})(e,h,g,p,f,c,u,v,d,i),((e,t)=>{e.on("init DisabledStateChange",(()=>{o(e.mode.get())})),e.on("SwitchMode",(e=>{o(e.mode)}));const o=o=>{const n=Eo(e,o);var r;t.set(n),"readonly"!==o&&((e=>"read"===e)(r=n)||(e=>"comment"===e)(r))&&e.mode.set("readonly")}})(e,l),e.on("PostRender",(()=>{(e=>{var t;const o=po(e)+"/tinycomments.css",n=A.from(null===(t=e.ui)||void 0===t?void 0:t.styleSheetLoader).getOr(tinymce.DOM.styleSheetLoader);((e,t,o)=>{const n=null!=o?o:tinymce.DOM.styleSheetLoader;if(tinymce.Resource.has(e)){const t=tinymce.Resource.get(e);return tinymce.DOM.styleSheetLoader.loadRawCss(e,t),Promise.resolve()}n.load(t)})("tinycomments/css/tinycomments.css",o,n),e.on("remove",(()=>n.unload(o)))})(e)}));const b=()=>{const t=P(e.annotator.getAll("tinycomments"));((e,t,o=r)=>n(o).eq(e,t))(t,i.get(),o)||i.set(t)},w=(e=>{let t=null;const o=()=>{_(t)||(clearTimeout(t),t=null)};return{cancel:o,throttle:(...n)=>{o(),t=setTimeout((()=>{t=null,e.apply(null,n)}),250)}}})(b);return e.on("LoadContent",b),e.on("SetContent input Change",w.throttle),e.on("remove",w.cancel),e.on("GetContent",(t=>{if(m(t.content)){const o=!0===t.source_view,n=!0===t.contextual,r=!0===t.selection,s=o||n||r?A.none():h.lifecycleHooks.onGetContent(e,t.content);t.content=s.getOr(t.content)}})),((e,t)=>({getEventLog:Xe(t),hasLoadedUi:e.get}))(s,a)};tinymce.PluginManager.requireLangPack("tinycomments","ar,bg_BG,ca,cs,da,de,el,es,eu,fa,fi,fr_FR,he_IL,hi,hr,hu_HU,id,it,ja,kk,ko_KR,ms,nb_NO,nl,pl,pt_PT,pt_BR,ro,ru,sk,sl_SI,sv_SE,th_TH,tr,uk,vi,zh_CN,zh_TW"),tinymce.PluginManager.add("tinycomments",((e,t)=>((e,t)=>!!e&&-1===((e,t)=>{const o=Y(e.major,t.major);if(0!==o)return o;const n=Y(e.minor,t.minor);if(0!==n)return n;const r=Y(e.patch,t.patch);return 0!==r?r:0})((e=>W((e=>[e.majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."))(e)))(e),W(t)))(tinymce,"6.8.0")?(console.error("The tinycomments plugin requires at least version 6.8.0 of TinyMCE."),{}):on(e,t)))}();
