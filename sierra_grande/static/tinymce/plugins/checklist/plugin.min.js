/*!
 * Tiny Checklist plugin
 *
 * Copyright (c) 2023 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 7.8.0-392
 */

!function(){"use strict";const t=t=>parseInt(t,10),e=(t,e)=>{const o=t-e;return 0===o?0:o>0?1:-1},o=(t,e,o)=>({major:t,minor:e,patch:o}),n=e=>{const n=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(e);return n?o(t(n[1]),t(n[2]),t(n[3])):o(0,0,0)},r=t=>e=>typeof e===t,s=t=>"string"===(t=>{const e=typeof t;return null===t?"null":"object"===e&&Array.isArray(t)?"array":"object"===e&&(o=n=t,(r=String).prototype.isPrototypeOf(o)||(null===(s=n.constructor)||void 0===s?void 0:s.name)===r.name)?"string":e;var o,n,r,s})(t),i=r("boolean"),c=t=>!(t=>null==t)(t),l=r("function"),a=r("number");class u{constructor(t,e){this.tag=t,this.value=e}static some(t){return new u(!0,t)}static none(){return u.singletonNone}fold(t,e){return this.tag?e(this.value):t()}isSome(){return this.tag}isNone(){return!this.tag}map(t){return this.tag?u.some(t(this.value)):u.none()}bind(t){return this.tag?t(this.value):u.none()}exists(t){return this.tag&&t(this.value)}forall(t){return!this.tag||t(this.value)}filter(t){return!this.tag||t(this.value)?this:u.none()}getOr(t){return this.tag?this.value:t}or(t){return this.tag?this:t}getOrThunk(t){return this.tag?this.value:t()}orThunk(t){return this.tag?this:t()}getOrDie(t){if(this.tag)return this.value;throw new Error(null!=t?t:"Called getOrDie on None")}static from(t){return c(t)?u.some(t):u.none()}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(t){this.tag&&t(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}u.singletonNone=new u(!1);const d=()=>false;const m=Array.prototype.indexOf,h=(t,e)=>{return o=t,n=e,m.call(o,n)>-1;var o,n},g=(t,e)=>{const o=t.length,n=new Array(o);for(let r=0;r<o;r++){const o=t[r];n[r]=e(o,r)}return n},f=(t,e)=>{for(let o=0,n=t.length;o<n;o++)e(t[o],o)},p=(t,e)=>{const o=[];for(let n=0,r=t.length;n<r;n++){const r=t[n];e(r,n)&&o.push(r)}return o},v=Object.keys;"undefined"!=typeof window?window:Function("return this;")();const k=t=>t.dom.nodeName.toLowerCase(),y=t=>1===(t=>t.dom.nodeType)(t);const w=t=>e=>y(e)&&k(e)===t,b=(t,e,o)=>{if(!(s(o)||i(o)||a(o)))throw console.error("Invalid call to Attribute.set. Key ",e,":: Value ",o,":: Element ",t),new Error("Attribute value was not simple");t.setAttribute(e,o+"")},L=(t,e,o)=>{b(t.dom,e,o)},N=(t,e)=>{t.dom.removeAttribute(e)},S=(t,e)=>{const o=((t,e)=>{const o=t.dom.getAttribute(e);return null===o?void 0:o})(t,e);return void 0===o||""===o?[]:o.split(" ")},x=t=>void 0!==t.dom.classList,C=t=>S(t,"class"),O=(t,e)=>((t,e,o)=>{const n=S(t,e).concat([o]);return L(t,e,n.join(" ")),!0})(t,"class",e),A=(t,e)=>((t,e,o)=>{const n=p(S(t,e),(t=>t!==o));return n.length>0?L(t,e,n.join(" ")):N(t,e),!1})(t,"class",e),T=(t,e)=>{x(t)?t.dom.classList.add(e):O(t,e)},M=t=>{0===(x(t)?t.dom.classList:C(t)).length&&N(t,"class")},E=(t,e)=>{x(t)?t.dom.classList.remove(e):A(t,e),M(t)},j=(t,e)=>x(t)&&t.dom.classList.contains(e),B=t=>{if(null==t)throw new Error("Node cannot be null or undefined");return{dom:t}},D=(t,e)=>{const o=(e||document).createElement(t);return B(o)},P=B,I=(t,e)=>{const o=t.dom;if(1!==o.nodeType)return!1;{const t=o;if(void 0!==t.matches)return t.matches(e);if(void 0!==t.msMatchesSelector)return t.msMatchesSelector(e);if(void 0!==t.webkitMatchesSelector)return t.webkitMatchesSelector(e);if(void 0!==t.mozMatchesSelector)return t.mozMatchesSelector(e);throw new Error("Browser lacks native selectors")}},R=t=>u.from(t.dom.parentNode).map(P),U=t=>g(t.dom.childNodes,P),V=t=>(t=>{const e=t.dom.childNodes;return u.from(e[0]).map(P)})(t),q=t=>w("li")(t)&&R(t).filter((t=>"ul"===k(t)&&j(t,"tox-checklist"))).isSome(),$=t=>((t,e)=>{const o=x(t)?t.dom.classList.toggle(e):((t,e)=>h(C(t),e)?A(t,e):O(t,e))(t,e);return M(t),o})(t,"tox-checklist--checked"),z=t=>h(["ul","ol","dl"],k(t)),X=t=>(u.from(t).filter((t=>j(t,"tox-checklist"))).bind(V).map((t=>{w("li")(t)&&V(t).exists(w("ul"))&&T(t,"tox-checklist--hidden")})),t);var F=(t,e,o,n,r)=>t(o,n)?u.some(o):l(r)&&r(o)?u.none():e(o,n,r);const K=(t,e,o)=>{let n=t.dom;const r=l(o)?o:d;for(;n.parentNode;){n=n.parentNode;const t=P(n);if(e(t))return u.some(t);if(r(t))break}return u.none()},W=(t,e)=>{t.dom.appendChild(e.dom)},G=(t,e)=>{const o=((t,e)=>{const o=D(e),n=(r=t.dom.attributes,s=(t,e)=>(t[e.name]=e.value,t),i={},f(r,((t,e)=>{i=s(i,t)})),i);var r,s,i;return((t,e)=>{const o=t.dom;((t,e)=>{const o=v(t);for(let n=0,r=o.length;n<r;n++){const r=o[n];e(t[r],r)}})(e,((t,e)=>{b(o,e,t)}))})(o,n),o})(t,e);var n,r;return r=o,(t=>u.from(t.dom.nextSibling).map(P))(n=t).fold((()=>{R(n).each((t=>{W(t,r)}))}),(t=>{((t,e)=>{R(t).each((o=>{o.dom.insertBefore(e.dom,t.dom)}))})(t,r)})),((t,e)=>{f(e,(e=>{W(t,e)}))})(o,U(t)),(t=>{const e=t.dom;null!==e.parentNode&&e.parentNode.removeChild(e)})(t),o},H=(t,e,o)=>K(t,(t=>I(t,e)),o),J=t=>e=>c(e)&&t.test(e.nodeName),Q=J(/^(OL|UL|DL)$/),Y=J(/^(LI|DT|DD)$/),Z=["OL","UL","DL"],_=Z.join(","),tt=(t,e)=>{const o=t.dom.getParents(e,t.dom.isBlock);return(n=o,r=e=>{return o=t.schema,!Q(n=e)&&!Y(n)&&(t=>{for(let r=0,s=t.length;r<s;r++)if(e=t[r],o.isValidChild(n.nodeName,e))return!0;var e;return!1})(Z);var o,n},((t,e,o)=>{for(let n=0,r=t.length;n<r;n++){const r=t[n];if(e(r,n))return u.some(r);if(o(r,n))break}return u.none()})(n,r,d)).getOr(t.getBody());var n,r},et=t=>{const e=t=>"ol"===k(t)||"ul"===k(t),o=()=>{const o=P(t.selection.getNode());var n,r;t.selection.isEditable()&&(n=o,r=e,F(((t,e)=>e(t)),K,n,r,undefined)).fold((()=>{t.undoManager.transact((()=>{t.execCommand("InsertUnorderedList",!1,{"list-attributes":{class:"tox-checklist"}}),f(p(g(t.selection.getSelectedBlocks(),P),e),(t=>T(t,"tox-checklist")))}))}),(e=>{t.undoManager.transact((()=>{if(j(e,"tox-checklist"))t.execCommand("RemoveList");else{const o=t.selection.getBookmark(),n=(t=>{const e=(t=>{const e=t.selection.getStart(!0);return t.dom.getParent(e,_,tt(t,e))})(t),o=t.selection.getSelectedBlocks();return((t,e)=>c(t)&&1===e.length&&e[0]===t)(e,o)?(t=>p(t.querySelectorAll(_),Q))(e):p(o,(t=>Q(t)&&e!==t))})(t).map(P);f([e,...n],(t=>{const e=G(t,"ul");T(e,"tox-checklist")})),t.selection.moveToBookmark(o)}}))}))};t.ui.registry.addToggleButton("checklist",{icon:"checklist",tooltip:"Insert Checklist",onAction:o,onSetup:o=>{const n=P(t.getBody()),r=t=>{return o=n,t.dom===o.dom||e(t);var o},s=e=>o.setActive(!t.readonly&&((t,e,o)=>F(((t,e)=>I(t,e)),H,t,".tox-checklist",o))(P(e),0,r).isSome()),i=()=>{const e=t.selection.isEditable();o.setEnabled(!t.readonly&&e)},c=t=>{s(t.element),i()};return t.on("NodeChange",c),s(t.selection.getNode()),i(),()=>t.off("NodeChange",c)}}),t.ui.registry.addMenuItem("checklist",{icon:"checklist",text:"Checklist",onAction:o,onSetup:e=>{const o=()=>{const o=t.selection.isEditable();e.setEnabled(!t.readonly&&o)};return t.on("NodeChange",o),o(),()=>t.off("NodeChange",o)}})};tinymce.PluginManager.add("checklist",(t=>{((t,o)=>!!t&&-1===((t,o)=>{const n=e(t.major,o.major);if(0!==n)return n;const r=e(t.minor,o.minor);if(0!==r)return r;const s=e(t.patch,o.patch);return 0!==s?s:0})((t=>n((t=>[t.majorVersion,t.minorVersion].join(".").split(".").slice(0,3).join("."))(t)))(t),n(o)))(tinymce,"6.0.0")?console.error("The Checklist Plugin requires at least version 6.0.0 of TinyMCE"):(t.on("init",(()=>{t.hasPlugin("lists",!0)||t.windowManager.alert("Please use the Checklist Plugin together with the Lists plugin.")})),(t=>{t.on("ListMutation",(t=>{const e=u.from(t.element).map(P);"IndentList"===t.action||"OutdentList"===t.action?e.map(X).map((t=>f(((t,e)=>{const o=void 0===e?document:e.dom;return 1!==(n=o).nodeType&&9!==n.nodeType&&11!==n.nodeType||0===n.childElementCount?[]:g(o.querySelectorAll(t),P);var n})("ul",t),(t=>X(t))))):"ToggleUlList"!==t.action&&"ToggleOlList"!==t.action&&"ToggleDLList"!==t.action||e.filter(z).map((t=>{E(t,"tox-checklist"),f(U(t),(t=>E(t,"tox-checklist--checked")))}))}))})(t),et(t),(t=>{t.shortcuts.add("meta+13","Check checklist item",(()=>{const e=t.selection.getSelectedBlocks();f(e,(e=>{const o=P(e);q(o)&&!t.mode.isReadOnly()&&$(o)}))}))})(t),(t=>{const e=(t=>{let e=t;return{get:()=>e,set:t=>{e=t}}})(u.none());t.on("mousedown touchstart",(o=>{const n=P(o.target);!((t,e)=>e.exists((e=>"touchstart"===e.type&&"mousedown"===t.type&&t.timeStamp-e.timeStamp<250)))(o,e.get())&&q(n)&&((t,e,o)=>{const n=t.document.createRange();return n.selectNodeContents(e.dom),o<n.getBoundingClientRect().left})(t.contentWindow,n,(t=>(t=>"touchstart"===t.type)(t)?t.touches[0].clientX:t.clientX)(o))&&!t.mode.isReadOnly()&&(e.set(u.some(o)),t.undoManager.transact((()=>{o.preventDefault(),$(n)})))}))})(t))}))}();