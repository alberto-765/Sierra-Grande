/*!
 * Tiny Mentions plugin
 *
 * Copyright (c) 2023 Ephox Corporation DBA Tiny Technologies, Inc.
 * Licensed under the Tiny commercial license. See https://www.tiny.cloud/legal/
 *
 * Version: 7.8.0-392
 */

!function(){"use strict";const e=e=>parseInt(e,10),t=(e,t)=>{const n=e-t;return 0===n?0:n>0?1:-1},n=(e,t,n)=>({major:e,minor:t,patch:n}),o=t=>{const o=/([0-9]+)\.([0-9]+)\.([0-9]+)(?:(\-.+)?)/.exec(t);return o?n(e(o[1]),e(o[2]),e(o[3])):n(0,0,0)},r=e=>t=>typeof t===e,s=e=>"string"===(e=>{const t=typeof e;return null===e?"null":"object"===t&&Array.isArray(e)?"array":"object"===t&&(n=o=e,(r=String).prototype.isPrototypeOf(n)||(null===(s=o.constructor)||void 0===s?void 0:s.name)===r.name)?"string":t;var n,o,r,s})(e);const i=e=>null===e;const l=r("boolean"),a=r("function"),c=r("number"),m=()=>{},u=(e,t)=>e===t,d=()=>!1;class h{constructor(e,t){this.tag=e,this.value=t}static some(e){return new h(!0,e)}static none(){return h.singletonNone}fold(e,t){return this.tag?t(this.value):e()}isSome(){return this.tag}isNone(){return!this.tag}map(e){return this.tag?h.some(e(this.value)):h.none()}bind(e){return this.tag?e(this.value):h.none()}exists(e){return this.tag&&e(this.value)}forall(e){return!this.tag||e(this.value)}filter(e){return!this.tag||e(this.value)?this:h.none()}getOr(e){return this.tag?this.value:e}or(e){return this.tag?this:e}getOrThunk(e){return this.tag?this.value:e()}orThunk(e){return this.tag?this:e()}getOrDie(e){if(this.tag)return this.value;throw new Error(null!=e?e:"Called getOrDie on None")}static from(e){return null==e?h.none():h.some(e)}getOrNull(){return this.tag?this.value:null}getOrUndefined(){return this.value}each(e){this.tag&&e(this.value)}toArray(){return this.tag?[this.value]:[]}toString(){return this.tag?`some(${this.value})`:"none()"}}h.singletonNone=new h(!1);const p=(e,t)=>{const n=e.length,o=new Array(n);for(let r=0;r<n;r++){const n=e[r];o[r]=t(n,r)}return o},g=(e,t)=>{for(let n=0,o=e.length;n<o;n++)t(e[n],n)},v=e=>t=>t.options.get(e),f=v("mentions_menu_hover"),y=v("mentions_fetch"),_=v("mentions_menu_complete"),b=v("mentions_menu_cancel"),x=v("mentions_select"),w=v("mentions_selector"),T=v("mentions_css_url"),C=v("mentions_item_type"),E=v("mentions_min_chars"),M=(e,t)=>e.dom.is(t,O(e)),O=w,S="data-mce-mentions-id",A=e=>{console.error(e)},N=e=>e&&"string"==typeof e.id&&"string"==typeof e.name,L=e=>{N(e)||A("mentions_fetch didn't produce a valid list of users.")},R=Object.hasOwnProperty,P=(e,t)=>j(e,t)?h.from(e[t]):h.none(),j=(e,t)=>R.call(e,t);"undefined"!=typeof window?window:Function("return this;")();const D=(e,t,n)=>{((e,t,n)=>{if(!(s(n)||l(n)||c(n)))throw console.error("Invalid call to Attribute.set. Key ",t,":: Value ",n,":: Element ",e),new Error("Attribute value was not simple");e.setAttribute(t,n+"")})(e.dom,t,n)},k=(e,t)=>{e.dom.removeAttribute(t)},V=(e,t)=>{(e=>void 0!==e.dom.classList)(e)?e.dom.classList.add(t):((e,t)=>{((e,t,n)=>{const o=((e,t)=>{const n=((e,t)=>{const n=e.dom.getAttribute(t);return null===n?void 0:n})(e,t);return void 0===n||""===n?[]:n.split(" ")})(e,t),r=o.concat([n]);D(e,t,r.join(" "))})(e,"class",t)})(e,t)},U=e=>{if(null==e)throw new Error("Node cannot be null or undefined");return{dom:e}},z=(e,t)=>{const n=(t||document).createElement(e);return U(n)},B=U,F=(e,t)=>{const n=e.dom;if(1!==n.nodeType)return!1;{const e=n;if(void 0!==e.matches)return e.matches(t);if(void 0!==e.msMatchesSelector)return e.msMatchesSelector(t);if(void 0!==e.webkitMatchesSelector)return e.webkitMatchesSelector(t);if(void 0!==e.mozMatchesSelector)return e.mozMatchesSelector(t);throw new Error("Browser lacks native selectors")}},H=(e,t)=>{e.dom.appendChild(t.dom)},I=(e,t)=>{e.dom.textContent=t},W=e=>t=>{var n;t instanceof window.HTMLElement?e(t):(n=t,"profile"===n.type?h.some((e=>{var t;const n=z("div");V(n,"tox"),V(n,"tox-mentions__card"),h.from(e.image).each((e=>{const t=z("img");D(t,"src",e),V(t,"tox-mentions__avatar"),H(n,t)}));const o=z("div");V(o,"tox-mentions__container"),H(n,o);const r=z("div");return V(r,"tox-mentions__username"),I(r,null!==(t=e.fullName)&&void 0!==t?t:e.name),H(o,r),h.from(e.description).map((e=>{const t=z("div");V(t,"tox-mentions__description"),I(t,e),H(o,t)})),n})(n.user)):h.none()).each((t=>e(t.dom)))},q=(e,t,n)=>((e,n,o)=>{let r=e.dom;const s=a(o)?o:d;for(;r.parentNode;){r=r.parentNode;const e=B(r);if(F(e,t))return h.some(e);if(s(e))break}return h.none()})(e,0,n),K=(e,t,n)=>((e,t,n,o,r)=>((e,t)=>F(e,t))(n,o)?h.some(n):a(r)&&r(n)?h.none():t(n,o,r))(0,q,e,t,n),$=(e,t)=>({left:e,top:t,translate:(n,o)=>$(e+n,t+o)}),G=$,J=(e,t)=>{let n;if(e.inline)return t;{n=tinymce.DOM.getPos(e.getContentAreaContainer());const o=(e=>{const t=void 0!==e?e.dom:document,n=t.body.scrollLeft||t.documentElement.scrollLeft,o=t.body.scrollTop||t.documentElement.scrollTop;return G(n,o)})(B(e.getDoc()));return{...t,x:t.x+n.x-o.left,y:t.y+n.y-o.top}}},Q=(e,t)=>{const n=tinymce.util.Delay,o={};let r=null;const s=(()=>{const e=(e=>{const t=(e=>{let t=e;return{get:()=>t,set:e=>{t=e}}})(h.none()),n=()=>t.get().each(e);return{clear:()=>{n(),t.set(h.none())},isSet:()=>t.get().isSome(),get:()=>t.get(),set:e=>{n(),t.set(h.some(e))}}})(m);return{...e,on:t=>e.get().each(t)}})(),l=E(e),a=C(e);let c,d;const v=()=>{null!==r&&null!==r.parentNode&&(r.removeEventListener("mouseover",_),r.removeEventListener("mouseout",b),r.parentNode.removeChild(r)),r=null},f=()=>{v()},y=o=>{clearTimeout(c),clearTimeout(d),c=n.setEditorTimeout(e,(()=>{return n=o,t.selectCard(n,(t=>{v(),r=t,r.addEventListener("mouseover",_),r.addEventListener("mouseout",b),r.style.position="absolute",r.style.left="-10000px",r.style.top="-10000px",V(B(r),"tox-mentions__card-common"),document.body.appendChild(r),((e,t,n,o)=>{let r;const s=((e,t)=>J(e,e.dom.getRect(t)))(e,n);r=tinymce.DOM.getRect(t),r=((e,t,n)=>{const o=tinymce.DOM.getViewPort(),r={...o,w:o.w-30,h:o.h-30},s=tinymce.geom.Rect,i=s.findBestRelativePosition(e,t,r,n);return s.relativePosition(e,t,i||n[0]||"bl-tl")})(r,s,o),tinymce.DOM.setStyles(t,{position:"absolute",left:r.x,top:r.y})})(e,r,n,["bl-tl","tl-bl","tl-br","bl-tr"])}));var n}),0)},_=()=>{clearTimeout(d)},b=()=>{clearTimeout(d),clearTimeout(c),d=n.setEditorTimeout(e,f,300)},x=()=>s.isSet()||M(e,e.selection.getNode())&&!e.selection.isCollapsed(),w="name"===a?(e,t)=>({type:"autocompleteitem",value:e.id,text:e.name,meta:{user:e,tooltipWorker:t}}):(e,t)=>{const n=P(e,"image").map((t=>({type:"cardimage",src:t,classes:["tox-mentions__avatar"],alt:e.name}))).toArray(),o=P(e,"description").map((e=>({type:"cardtext",text:e,classes:["tox-mentions__description"]}))).toArray();return{type:"cardmenuitem",value:e.id,label:e.name,items:[...n,{type:"cardcontainer",direction:"vertical",items:[{type:"cardtext",text:e.name,name:"username",classes:["tox-mentions__username"]},...o]}],meta:{user:e,tooltipWorker:t}}};e.ui.registry.addAutocompleter("mentions",{trigger:"@",minChars:l,maxResults:10,highlightOn:["username"],onAction:(n,r,s,i)=>{if(((e,t,n=u)=>e.exists((e=>n(e,t))))(P(i,"reload"),!0)){const{reload:e,...t}=i;n.reload(t)}else((n,r)=>{const s=t.getMention(n);((e,t)=>{const n=M(e,t);return n||A("mentions_complete needs to produce a element that matches selector: "+O(e)),n})(e,s)&&(s.contentEditable="false",s.setAttribute(S,n.id),o[n.id]=n,e.selection.setRng(r),e.insertContent(s.outerHTML))})(i.user,r),n.hide()},fetch:(e,n,o)=>new Promise((r=>{(e=>{let t=null;const n=()=>{i(t)||(clearTimeout(t),t=null)};return{cancel:n,throttle:(...o)=>{n(),t=setTimeout((()=>{t=null,e.apply(null,o)}),300)}}})((()=>{t.getUsers(e,((e,n)=>{r(((e,n=[])=>{const o=p(e,(e=>w(e,(n=>t.hoverCard(e,n))))),r=p(n,(e=>({value:void 0===e.value?"":e.value,text:e.text,meta:{...e.meta,reload:!0}})));return[...o,...r.length>0?[{type:"separator"}]:[],...r]})(e,n))}),n,o)})).throttle()})),columns:1}),(e=>{e.on("SetContent",(()=>{(e=>{const t=e.dom.select(O(e),void 0);g(t,(e=>D(B(e),"contenteditable","false"))),t.length>0&&e.hasFocus()&&e.selection.setRng(e.selection.getRng())})(e)})),e.on("PreProcess",(t=>{((e,t,n)=>{g(e.dom.select(O(e),t),(e=>{const t=B(e);k(t,"contenteditable"),n||k(t,S)}))})(e,t.node,t.source_view)})),e.on("ResolveName",(t=>{M(e,t.target)&&(t.name="mention")}))})(e),e.on("mouseover",(t=>{K(B(t.target),O(e)).each((e=>{s.set(!0),y(e.dom)}))})),e.on("mouseout",(t=>{K(B(t.target),O(e)).each((()=>{s.clear(),x()||f()}))})),e.on("nodechange",(t=>{M(e,t.element)&&!e.selection.isCollapsed()?y(t.element):x()||b()})),e.on("remove",v)};tinymce.PluginManager.add("mentions",((e,n)=>{if(!((e,n)=>!!e&&-1===((e,n)=>{const o=t(e.major,n.major);if(0!==o)return o;const r=t(e.minor,n.minor);if(0!==r)return r;const s=t(e.patch,n.patch);return 0!==s?s:0})((e=>o((e=>[e.majorVersion,e.minorVersion].join(".").split(".").slice(0,3).join("."))(e)))(e),o(n)))(tinymce,"6.8.0")){((e,t)=>{const n=e.options.register;g(["mentions_menu_hover","mentions_fetch","mentions_menu_complete","mentions_menu_cancel","mentions_select"],(e=>{n(e,{processor:"function"})})),n("mentions_selector",{processor:"string",default:".mention"}),n("mentions_css_url",{processor:"string",default:t+"/css"}),n("mentions_item_type",{processor:"string",default:"name"}),n("mentions_min_chars",{processor:"number",default:1})})(e,n);const t=(e=>{const t=tinymce.util.Tools,n=(e=>{const t=(e,t)=>a(e)?e:t,n=(e,n)=>{let o;const r=t(e,n);return(...e)=>{let t={};const n=e.map((e=>{var n;return"function"==typeof e&&(n=e,e=(...e)=>{t===o&&n(...e)}),e}));t=o={},r(...n)}},o=n(f(e),m),r=t(y(e),((e,t)=>{t([])})),s=t(_(e),((t,n)=>{const o=e.dom.create("span",{class:"mention"});return o.appendChild(e.dom.doc.createTextNode("@"+n.name)),o})),i=t(b(e),m);return{hover:o,fetch:r,complete:s,select:n(x(e),m),cancel:i}})(e);return{getUsers:(e,o,r=10,s={})=>{n.fetch({term:e,meta:s},((e,n)=>{t.each(e,L);const s=e.slice(0,r);o(t.grep(s,N),n)}))},getMention:t=>n.complete(e,t),hoverCard:(e,t)=>n.hover(e,W(t)),selectCard:(e,t)=>n.select(e,W(t))}})(e);return Q(e,t),e.on("init",(()=>{(e=>{var t;const n=T(e)+"/",o=h.from(null===(t=e.ui)||void 0===t?void 0:t.styleSheetLoader).getOr(tinymce.DOM.styleSheetLoader),r="mentions/css/mentions.css";if(tinymce.Resource.has(r)){const e=tinymce.Resource.get(r);return Promise.resolve(o.loadRawCss(r,e))}o.load(n+"mentions.css").catch(m)})(e)})),t}console.error("The mentions plugin requires at least version 6.8.0 of TinyMCE.")}))}();