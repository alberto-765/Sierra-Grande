{% extends "oscar/dashboard/layout.html" %}

{% load currency_filters %}
{% load i18n %}

{% block body_class %}
  {{ block.super }} orders home
{% endblock body_class %}
{% block extrahead %}
  {{ block.super }}
  <meta http-equiv="refresh" content="300" />
{% endblock extrahead %}
{% block breadcrumbs %}
{% endblock breadcrumbs %}
{% block main_header_content %}
  {% translate "Dashboard" %}
{% endblock main_header_content %}
{% block dashboard_content %}
  <div class="card">
    <span class="card-header fw-normal">
      <iconify-icon icon="lucide:signal-high" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
      {% translate "Your Store Statistics" %}
    </span>
    <div class="card-body">
      <div class="row gy-3">
        <aside class="col-md-3 vstack align-items-start gap-2">
          <label class="icon-link">
            <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
            <span>
              {{ total_orders_last_day }}
              {% translate "Total Orders" %}
            </span>
          </label>
          <label class="icon-link">
            <iconify-icon icon="ri:hand-coin-fill" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
            <span>
              {{ total_customers_last_day }}
              {% translate "New Customers" %}
            </span>
          </label>
          <label class="icon-link">
            <iconify-icon icon="fa-solid:users" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
            <span>
              {{ total_customers }}
              {% translate "Total Customers" %}
            </span>
          </label>
          <label class="icon-link">
            <iconify-icon icon="bi:box-seam" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
            <span>
              {{ total_products }}
              {% translate "Total Products" %}
            </span>
          </label>
        </aside>
        <div class="col-md-9">
          <div id="order_graph">
            <div class="bar-caption">
              <h2 class="mb-0">{% translate "Latest Orders (last 24 hours)" %}</h2>
            </div>
            <div class="bar-y-axis">
              <ul>
                {% for y_value in hourly_report_dict.y_range %}
                  <li>
                    <span>{{ y_value|currency }}</span>
                  </li>
                {% endfor %}
              </ul>
            </div>
            <dl class="bar-chart">
              {% for item in hourly_report_dict.order_total_hourly %}
                <dd class="bar-layer">
                  <em>{{ item.end_time|time }}</em>
                  <span style="height: {{ item.percentage }}%;">
                    <p {% if item.percentage == 0 %}style="display: none;"{% endif %}>{{ item.total_incl_tax|currency }}</p>
                  </span>
                </dd>
              {% endfor %}
            </dl>
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row g-4">
    <div class="col-md-6 col-lg-4 order-md-first">
      <div class="card">
        <span class="card-header icon-link fw-normal">
          <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
          {% translate "Orders - Last 24 Hours" %}
        </span>
        <div class="card-body p-0">
          <div class="table-card table-responsive-md">
            <table class="table table-striped table-bordered table-hover align-middle">
              <tr>
                <td>{% translate "Total orders" %}</td>
                <td class="text-center">{{ total_orders_last_day }}</td>
              </tr>
              <tr>
                <td>{% translate "Total lines" %}</td>
                <td class="text-center">{{ total_lines_last_day }}</td>
              </tr>
              <tr>
                <td>{% translate "Total revenue" %}</td>
                <td class="text-center">{{ total_revenue_last_day|currency }}</td>
              </tr>
              <tr>
                <td>{% translate "Average order costs" %}</td>
                <td class="text-center">{{ average_order_costs|currency }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4 order-md-1">
      <div class="card">
        <div class="card-header hstack justify-content-between align-items-center">
          <span class="icon-link fw-normal">
            <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
            {% translate "Orders - All Time" %}
          </span>
          <a href="{% url "dashboard:order-list" %}"
             class="btn btn-secondary icon-link">
            <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>{% translate "Manage" %}
          </a>
        </div>
        <div class="card-body p-0">
          <div class="table-card table-responsive-md">
            <table class="table table-striped table-bordered table-hover align-middle">
              <tr>
                <td>{% translate "Total orders" %}</td>
                <td class="text-center">{{ total_orders }}</td>
              </tr>
              <tr>
                <td>{% translate "Total lines" %}</td>
                <td class="text-center">{{ total_lines }}</td>
              </tr>
              <tr>
                <td>{% translate "Total revenue" %}</td>
                <td class="text-center">{{ total_revenue|currency }}</td>
              </tr>
              <tr>
                <td>
                  {% translate "Total <em>open</em> baskets" %}
                </td>
                <td class="text-center">{{ total_open_baskets }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-4 order-lg-2 order-md-4">
      <div class="card">
        <span class="card-header icon-link fw-normal">
          <iconify-icon icon="fa-solid:users" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
          {% translate "Customers" %}
        </span>
        <div class="card-body p-0">
          <div class="table-card table-responsive-md">
            <table class="table table-striped table-bordered table-hover align-middle">
              <tr>
                <td>{% translate "Total customers" %}</td>
                <td class="text-center">{{ total_customers }}</td>
              </tr>
              <tr>
                <td>{% translate "New customers" %}</td>
                <td class="text-center">{{ total_customers_last_day }}</td>
              </tr>
              <tr>
                <td>
                  {% translate "Total <em>open</em> baskets" %}
                </td>
                <td class="text-center">{{ total_open_baskets_last_day }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    <div class="col-md-6 col-lg-7 col-xl-6 order-lg-3 order-md-3">
      <div class="card">
        <div class="card-header">
          <div class="row row-cols-2 justify-content-between">
            <span class="icon-link col-4">
              <iconify-icon icon="fa-solid:sitemap" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
              {% translate "Catalogue and stock" %}
            </span>
            <div class="col-8 hstack column-gap-md-3 justify-content-between justify-content-lg-end">
              <a href="{% url "dashboard:catalogue-product-list" %}"
                 class="btn btn-secondary icon-link"
                 role="button">
                <iconify-icon icon="fa-solid:sitemap" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
                {% translate "Manage" %}
              </a>
              <a href="{% url "dashboard:stock-alert-list" %}"
                 class="btn btn-secondary icon-link"
                 role="button">
                <iconify-icon icon="fa-solid:sitemap" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
                {% translate "View Stock Alerts" %}
              </a>
            </div>
          </div>
        </div>
        <div class="card-body p-0">
          <div class="table-card table-responsive-md">
            <table class="table table-striped table-bordered table-hover align-middle">
              <tr>
                <td>{% translate "Total products" %}</td>
                <td class="text-center">{{ total_products }}</td>
              </tr>
              <tr>
                <td>
                  {% translate "<em>Open</em> stock alerts" %}
                </td>
                <td class="text-center">{{ total_open_stock_alerts }}</td>
              </tr>
              <tr>
                <td>
                  {% translate "<em>Closed</em> stock alerts" %}
                </td>
                <td class="text-center">{{ total_closed_stock_alerts }}</td>
              </tr>
            </table>
          </div>
        </div>
      </div>
    </div>
    {% if user.is_staff %}
      <div class="col-md-6 col-lg-5 col-xl-6 order-md-last">
        <div class="card">
          <span class="card-header icon-link fw-normal">
            <iconify-icon icon="ant-design:gift-filled" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
            {% translate "Offers, vouchers" %}
          </span>
          <div class="card-body p-0">
            <div class="table-card table-responsive-md">
              <table class="table table-striped table-bordered table-hover align-middle">
                {% for offer_map in offer_maps %}
                  <tr>
                    <td>
                      {% blocktranslate with offer_type=offer_map.offer_type %}Active <em>{{ offer_type }}</em> Offers{% endblocktranslate %}
                    </td>
                    <td class="text-center">{{ offer_map.count }}</td>
                  </tr>
                {% endfor %}
                <tr>
                  <td>
                    {% translate "Active <em>Vouchers</em>" %}
                  </td>
                  <td class="text-center">{{ total_vouchers }}</td>
                </tr>
              </table>
            </div>
          </div>
        </div>
      </div>
    {% endif %}
  </div>
{% endblock dashboard_content %}
