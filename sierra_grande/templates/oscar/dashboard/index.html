{% extends "oscar/dashboard/layout.html" %}

{% load currency_filters %}
{% load i18n %}

{% block body_class %}
  {{ block.super }} orders home
{% endblock body_class %}
{% block extrahead %}
  {{ block.super }}
  <meta http-equiv="refresh" content="300" />
{% endblock extrahead %}
{% block breadcrumbs %}
{% endblock breadcrumbs %}
{% block headertext %}
  {% trans "Dashboard" %}
{% endblock headertext %}
{% block dashboard_content %}
  <div class="table-header">
    <span class="icon-link">
      <iconify-icon icon="lucide:signal-high" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
      {% trans "Your Store Statistics" %}
    </span>
  </div>
  <div class="content-block">
    <div class="row">
      <aside class="col-md-3 order-graph-details">
        <label class="icon-link">
          <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
          <span>
            {{ total_orders_last_day }}
            {% trans "Total Orders" %}
          </span>
        </label>
        <label class="icon-link">
          <iconify-icon icon="ri:hand-coin-fill" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
          <span>
            {{ total_customers_last_day }}
            {% trans "New Customers" %}
          </span>
        </label>
        <label class="icon-link">
          <iconify-icon icon="fa-solid:users" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
          <span class="icon-link">
            {{ total_customers }}
            {% trans "Total Customers" %}
          </span>
        </label>
        <label>
          <iconify-icon icon="streamline:pork-meat-solid" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
          <span class="icon-link">
            {{ total_products }}
            {% trans "Total Products" %}
          </span>
        </label>
      </aside>
      <div class="col-md-9">
        <div id="order_graph">
          <div class="bar-caption">
            <h2>{% trans "Latest Orders (last 24 hours)" %}</h2>
          </div>
          <div class="bar-y-axis">
            <ul>
              {% for y_value in hourly_report_dict.y_range %}
                <li>
                  <span>{{ y_value|currency }}</span>
                </li>
              {% endfor %}
            </ul>
          </div>
          <dl class="bar-chart">
            {% for item in hourly_report_dict.order_total_hourly %}
              <dd class="bar-layer">
                <em>{{ item.end_time|time }}</em>
                <span style="height: {{ item.percentage }}%;">
                  <p {% if item.percentage == 0 %}style="display: none;"{% endif %}>{{ item.total_incl_tax|currency }}</p>
                </span>
              </dd>
            {% endfor %}
          </dl>
        </div>
      </div>
    </div>
  </div>
  <div class="d-flex flex-column gap-3">
    <div class="row">
      <div class="col icon-link">
        <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
        <span>{% trans "Orders - Last 24 Hours" %}</span>
      </div>
      <div class="col d-flex justify-content-between">
        <span class="icon-link">
          <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
          {% trans "Orders - All Time" %}
        </span>
        <a href="{% url "dashboard:order-list" %}"
           class="btn btn-secondary icon-link">
          <iconify-icon icon="fa-solid:shopping-cart" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>{% trans "Manage" %}
        </a>
      </div>
      <div class="col icon-link">
        <iconify-icon icon="fa-solid:users" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
        {% trans "Customers" %}
      </div>
    </div>
    <div class="row">
      <div class="col-md-4">
        <table class="table table-striped table-bordered table-hover vertical-middle caption-top">
          <tr>
            <td>{% trans "Total orders" %}</td>
            <td class="text-center">{{ total_orders_last_day }}</td>
          </tr>
          <tr>
            <td>{% trans "Total lines" %}</td>
            <td class="text-center">{{ total_lines_last_day }}</td>
          </tr>
          <tr>
            <td>{% trans "Total revenue" %}</td>
            <td class="text-center">{{ total_revenue_last_day|currency }}</td>
          </tr>
          <tr>
            <td>{% trans "Average order costs" %}</td>
            <td class="text-center">{{ average_order_costs|currency }}</td>
          </tr>
        </table>
      </div>
      <div class="col-md-4">
        <table class="table table-striped table-bordered table-hover caption-top vertical-middle">
          <tr>
            <td>{% trans "Total orders" %}</td>
            <td class="text-center">{{ total_orders }}</td>
          </tr>
          <tr>
            <td>{% trans "Total lines" %}</td>
            <td class="text-center">{{ total_lines }}</td>
          </tr>
          <tr>
            <td>{% trans "Total revenue" %}</td>
            <td class="text-center">{{ total_revenue|currency }}</td>
          </tr>
          <tr>
            <td>
              {% trans "Total <em>open</em> baskets" %}
            </td>
            <td class="text-center">{{ total_open_baskets }}</td>
          </tr>
        </table>
      </div>
      <div class="col-md-4">
        <table class="table table-striped table-bordered table-hover caption-top vertical-middle">
          <tr>
            <td>{% trans "Total customers" %}</td>
            <td class="text-center">{{ total_customers }}</td>
          </tr>
          <tr>
            <td>{% trans "New customers" %}</td>
            <td class="text-center">{{ total_customers_last_day }}</td>
          </tr>
          <tr>
            <td>
              {% trans "Total <em>open</em> baskets" %}
            </td>
            <td class="text-center">{{ total_open_baskets_last_day }}</td>
          </tr>
        </table>
      </div>
    </div>
    <div class="row">
      <div class="col d-flex justify-content-between">
        <iconify-icon icon="fa-solid:sitemap" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
        {% trans "Catalogue and stock" %}
      </div>
      <div class="d-flex gap-1">
        <a href="{% url "dashboard:catalogue-product-list" %}"
           class="btn btn-secondary icon-link"
           role="button">
          <iconify-icon icon="fa-solid:sitemap" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
          {% trans "Manage" %}
        </a>
        <a href="{% url "dashboard:stock-alert-list" %}"
           class="btn btn-secondary icon-link"
           role="button">
          <iconify-icon icon="fa-solid:sitemap" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
          {% trans "View Stock Alerts" %}
        </a>
      </div>
    </div>
    <div class="col icon-link">
      <iconify-icon icon="ant-design:gift-filled" width="1rem" height="1rem" aria-hidden="true" inline></iconify-icon>
      {% trans "Offers, vouchers" %}
    </div>
  </div>
  <div class="row">
    <div class="col-md-6">
      <table class="table table-striped table-bordered table-hover caption-top vertical-middle">
        <tr>
          <td>{% trans "Total products" %}</td>
          <td class="text-center">{{ total_products }}</td>
        </tr>
        <tr>
          <td>
            {% trans "<em>Open</em> stock alerts" %}
          </td>
          <td class="text-center">{{ total_open_stock_alerts }}</td>
        </tr>
        <tr>
          <td>
            {% trans "<em>Closed</em> stock alerts" %}
          </td>
          <td class="text-center">{{ total_closed_stock_alerts }}</td>
        </tr>
      </table>
    </div>
    <div class="col-md-6">
      {% if user.is_staff %}
        <table class="table table-striped table-bordered table-hover caption-top vertical-middle">
          {% for offer_map in offer_maps %}
            <tr>
              <td>
                {% blocktrans with offer_type=offer_map.offer_type %}Active <em>{{ offer_type }}</em> Offers{% endblocktrans %}
              </td>
              <td class="text-center">{{ offer_map.count }}</td>
            </tr>
          {% endfor %}
          <tr>
            <td>
              {% trans "Active <em>Vouchers</em>" %}
            </td>
            <td class="text-center">{{ total_vouchers }}</td>
          </tr>
        </table>
      {% endif %}
    </div>
  </div>
{% endblock dashboard_content %}
