{% extends "oscar/dashboard/layout.html" %}

{% load i18n %}

{% block title %}
  {% translate "Partners" %} | {{ block.super }}
{% endblock title %}
{% block breadcrumbs %}
  <nav aria-label="breadcrumb">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{% url "dashboard:partner-list" %}">{% translate "Partners" %}</a>
      </li>
      <li class="breadcrumb-item active" aria-current="page">{{ partner.name }}</li>
    </ol>
  </nav>
{% endblock breadcrumbs %}
{% block main_header %}
  <div>
    <h4 class="mb-sm-0">{% translate "Manage users" %}</h2>
    <div class="btn-group d-flex justify-content-between">
      <a class="btn btn-darken-primary dropdown-toggle icon-link"
         data-bs-toggle="dropdown"
         href="#">
        <iconify-icon icon="mdi:plus-circle" width="1rem" height="1rem" aria-hidden="true"></iconify-icon>
        {% translate "Link a user" %}
      </a>
      <ul class="dropdown-menu dropdown-menu-end">
        <li>
          <a href="{% url "dashboard:partner-user-create" partner_pk=partner.pk %}">{% translate "Link a new user" %}</a>
        </li>
        <li>
          <a href="{% url "dashboard:partner-user-select" partner_pk=partner.pk %}">{% translate "Link an existing user" %}</a>
        </li>
      </ul>
    </div>
  </div>
{% endblock main_header %}
{% block dashboard_content %}
  {% if users %}
    <table class="align-middle table table-striped table-bordered">
      <thead>
        <tr>
          <th>{% translate "Email" %}</th>
          <th>{% translate "First name" %}</th>
          <th>{% translate "Last name" %}</th>
          <th>&nbsp;</th>
        </tr>
      </thead>
      <tbody>
        {% for user in users %}
          <tr>
            <td>
              <a href="{% url "dashboard:partner-user-update" partner_pk=partner.pk user_pk=user.id %}">{{ user.email }}</a>
            </td>
            <td>{{ user.first_name|default:"-" }}</td>
            <td>{{ user.last_name|default:"-" }}</td>
            <td>
              <form action="{% url "dashboard:partner-user-unlink" partner_pk=partner.id user_pkuser.id %}"
                    method="post">
                {% csrf_token %}
                <button type="submit"
                        class="btn btn-danger"
                        data-loading-text="{% translate "Unlinking..." %}">{% translate "Unlink user" %}</button>
              </form>
            </td>
          </tr>
        {% endfor %}
      </tbody>
    </table>
  {% else %}
    <p>{% translate "No users linked." %}</p>
  {% endif %}
  {% include "oscar/dashboard/partials/pagination.html" %}
  <h1>{% translate "Update details" %}</h1>
  {% include "oscar/dashboard/partials/form.html" %}
{% endblock dashboard_content %}
