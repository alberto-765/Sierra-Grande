{% load i18n %}
{% load currency_filters %}

<div id="basket_totals">
  <table class="align-middle table table-sm">
    <tr>
      <th colspan="2">
        <h3>{% translate "Basket" %}</h3>
      </th>
    </tr>
    {% with discounts=order.basket_discounts %}
      {% block discount_totals %}
        {% if discounts %}
          <tr>
            <td>{% translate "Basket total (before discounts)" %}</td>
            <td class="text-end">{{ order.basket_total_before_discounts_incl_tax|currency:order.currency }}</td>
          </tr>
          {% for discount in discounts %}
            <tr>
              <td>
                <span class="badge bg-success-subtle text-success">{% translate "Discount" %}</span> {{ discount.offer }}
              </td>
              <td class="text-end">- {{ discount.amount|currency:order.currency }}</td>
            </tr>
          {% endfor %}
        {% endif %}
      {% endblock discount_totals %}
      {% block basket_total %}
        {% if discounts %}
          <tr>
            <th class="total">{% translate "Basket total (after discounts)" %}</th>
            <th class="total text-end">{{ order.basket_total_incl_tax|currency:order.currency }}</th>
          </tr>
        {% else %}
          <tr class="basket-items">
            <th class="total">{% translate "Basket total" %}</th>
            <th class="total text-end">
              {% if show_tax_separately %}
                {{ order.basket_total_excl_tax|currency:order.currency }}
              {% else %}
                {{ order.basket_total_incl_tax|currency:order.currency }}
              {% endif %}
            </th>
          </tr>
        {% endif %}
      {% endblock basket_total %}
    {% endwith %}
    {% block shipping_total %}
      <tr>
        <th>&nbsp;</th>
        <td></td>
      </tr>
      <tr>
        <th colspan="2">
          <h3>{% translate "Shipping" %}</h3>
        </th>
      </tr>
      <tr>
        <td>{% translate "Shipping method" %}</td>
        <td class="text-end">{{ order.shipping_method }}</td>
      </tr>
      {% if order.has_shipping_discounts %}
        <tr>
          <td>{% translate "Shipping charge (before discounts)" %}</td>
          <td class="text-end">{{ order.shipping_before_discounts_incl_tax|currency:order.currency }}</td>
        </tr>
        {% for discount in order.shipping_discounts %}
          <tr>
            <td>
              <span class="badge bg-success-subtle text-success">{% translate "Discount" %}</span> {{ discount.offer }}
            </td>
            <td class="text-end">- {{ discount.amount|currency:order.currency }}</td>
          </tr>
        {% endfor %}
        <tr>
          <th class="total">{% translate "Shipping charge (after discounts)" %}</th>
          <th class="total text-end">{{ order.shipping_incl_tax|currency:order.currency }}</th>
        </tr>
      {% else %}
        <tr>
          <th class="total">{% translate "Shipping charge" %}</th>
          <th class="total text-end">
            {% if show_tax_separately %}
              {{ order.shipping_excl_tax|currency:order.currency }}
            {% else %}
              {{ order.shipping_incl_tax|currency:order.currency }}
            {% endif %}
          </th>
        </tr>
      {% endif %}
    {% endblock shipping_total %}
    {% block surcharges %}
      {% with surcharges=order.surcharges.all %}
        {% if surcharges %}
          <tr>
            <th>&nbsp;</th>
            <td></td>
          </tr>
          <tr>
            <th colspan="2">
              <h3>{% translate "Surcharges" %}</h3>
            </th>
          </tr>
          {% for charge in surcharges %}
            <tr>
              <th class="total">{{ charge.name }}</th>
              <th class="total text-end">
                {% if show_tax_separately %}
                  {{ charge.excl_tax|currency:order.currency }}
                {% else %}
                  {{ charge.incl_tax|currency:order.currency }}
                {% endif %}
              </th>
            </tr>
          {% endfor %}
        {% endif %}
      {% endwith %}
    {% endblock surcharges %}
    {% if show_tax_separately %}
      <tr>
        <th colspan="2">&nbsp;</th>
      </tr>
      <tr>
        <th class="total">{% translate "Order tax" %}</th>
        <th class="total text-end">{{ order.total_tax|currency:order.currency }}</th>
      </tr>
    {% endif %}
    {% block post_order_action_totals %}
      {% with actions=order.post_order_actions %}
        {% if actions %}
          <tr>
            <th colspan="2">&nbsp;</th>
          </tr>
          <tr>
            <th colspan="2">
              <h3>{% translate "Post order actions" %}</h3>
            </th>
          </tr>
          {% for action in order.post_order_actions %}
            <tr>
              <td class="total" colspan="2">
                <p>{{ action.message }}</p>
              </td>
            </tr>
          {% endfor %}
        {% endif %}
      {% endwith %}
    {% endblock post_order_action_totals %}
    {% block order_total %}
      <tr>
        <th colspan="2">&nbsp;</th>
      </tr>
      <tr>
        <td class="total">
          <h3>{% translate "Order total" %}</h3>
        </td>
        <td class="total text-end">
          <h3 class="price_color">{{ order.total_incl_tax|currency:order.currency }}</h3>
        </td>
      </tr>
    {% endblock order_total %}
  </table>
</div>
